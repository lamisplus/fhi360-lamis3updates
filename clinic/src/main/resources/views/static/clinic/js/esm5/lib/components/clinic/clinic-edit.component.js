import * as tslib_1 from "tslib";
import { Component } from '@angular/core';
import { ClinicService } from '../../services/clinic.service';
import { NotificationService } from '@alfresco/adf-core';
import { ActivatedRoute } from '@angular/router';
import * as moment_ from 'moment';
import { AppLoaderService, DATE_FORMAT, entityCompare } from '@lamis/web-core';
import { ColumnMode } from '@swimlane/ngx-datatable';
var moment = moment_;
var ClinicEditComponent = /** @class */ (function () {
    function ClinicEditComponent(clinicService, notification, activatedRoute, appLoaderService) {
        this.clinicService = clinicService;
        this.notification = notification;
        this.activatedRoute = activatedRoute;
        this.appLoaderService = appLoaderService;
        this.error = false;
        this.today = moment();
        this.visitDates = [];
        this.selectedClinicAdr = [];
        this.oiList = [];
        this.adhereList = [];
        this.ColumnMode = ColumnMode;
        this.adr = false;
        this.otzApplicable = false;
    }
    ClinicEditComponent.prototype.createEntity = function () {
        return {};
    };
    ClinicEditComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.clinicService.opportunisticInfections().subscribe(function (res) { return _this.opportunisticInfections = res; });
        this.clinicService.adheres().subscribe(function (res) { return _this.adheres = res; });
        this.isSaving = false;
        this.clinicService.getRegimenLines().subscribe(function (res) {
            _this.regimenLines = res;
        });
        this.activatedRoute.data.subscribe(function (_a) {
            var entity = _a.entity;
            _this.commence = !!_this.activatedRoute.snapshot.data['commence'];
            _this.entity = !!entity && entity.body ? entity.body : entity;
            if (_this.entity === undefined) {
                _this.entity = _this.createEntity();
            }
            var patientId = _this.activatedRoute.snapshot.paramMap.get('patientId');
            _this.clinicService.getPatient(patientId).subscribe(function (res) {
                _this.entity.patient = res;
                _this.entity.facility = res.facility;
                _this.dateBirth = res.dateBirth;
                _this.dateRegistration = res.dateRegistration;
                _this.clinicService.enrolledOnOTZ(res.id).subscribe(function (r) { return _this.enrolledOnOTZ = r; });
                if (_this.entity.patient.statusAtRegistration === 'ART_TRANSFER_IN') {
                    _this.dateRegistration = _this.entity.patient.dateRegistration.clone().subtract(10, 'years');
                    if (_this.dateRegistration.isBefore(_this.entity.patient.dateBirth)) {
                        _this.dateRegistration = _this.entity.patient.dateBirth.clone().add(3, 'months');
                    }
                }
                _this.otzApplicable = !moment().subtract(24, 'years').isAfter(_this.entity.patient.dateBirth)
                    && !moment().subtract(10, 'years').isBefore(_this.entity.patient.dateBirth);
                _this.clinicService.getVisitDatesByPatient(_this.entity.patient.id).subscribe(function (res) {
                    _this.visitDates = res;
                });
            });
            if (_this.entity.commence && _this.entity.regimenType) {
                _this.regimenLineChange(_this.entity.regimenType);
            }
            _this.commence = _this.commence || _this.entity.commence;
            if (_this.commence) {
                _this.entity.commence = true;
                if (_this.entity.regimenType) {
                    _this.regimenLineChange(_this.entity.regimenType);
                }
            }
            if (_this.entity.id) {
                _this.appointmentMin = _this.entity.dateVisit.clone().add(14, 'days');
                _this.appointmentMax = _this.entity.dateVisit.clone().add(6, 'months');
                _this.clinicService.getAdhereByClinic(_this.entity.id).subscribe(function (res) {
                    _this.adhereList = res.map(function (ca) { return ca.adhere; });
                });
                _this.clinicService.adverseDrugReactions().subscribe(function (res1) {
                    _this.adverseDrugReactions = res1;
                    _this.clinicService.getAdverseDrugReactionsByClinic(_this.entity.id).subscribe(function (res) {
                        if (res.body && res.body.length > 0) {
                            _this.adr = true;
                        }
                        _this.adverseDrugReactions.forEach(function (adr) {
                            var found = false;
                            if (res.body) {
                                res.body.forEach(function (cadr) {
                                    if (cadr.adverseDrugReaction.id === adr.id) {
                                        found = true;
                                        _this.selectedClinicAdr.push(cadr);
                                    }
                                });
                            }
                            if (!found) {
                                _this.selectedClinicAdr.push({
                                    adverseDrugReaction: adr
                                });
                            }
                        });
                        _this.selectedClinicAdr = tslib_1.__spread(_this.selectedClinicAdr);
                    });
                    if (_this.entity.extra && _this.entity.extra.otz) {
                        _this.attendedLastOTZMeeting = !!_this.entity.extra.otz.attendedLastOTZMeeting;
                        _this.enrolledOnOTZ = !!_this.entity.extra.otz.enrolledOnOTZ;
                        if (!!_this.entity.extra.otz.dateEnrolledOnOTZ) {
                            _this.dateEnrolledOnOTZ = moment(_this.entity.extra.otz.dateEnrolledOnOTZ);
                        }
                        if (!!_this.entity.extra.otz.dateLastOTZMeeting) {
                            _this.dateLastOTZMeeting = moment(_this.entity.extra.otz.dateLastOTZMeeting);
                        }
                        _this.caregiverPhone = _this.entity.extra.otz.caregiverPhone;
                        _this.caregiverAddress = _this.entity.extra.otz.caregiverAddress;
                        _this.modulesCompleted = _this.entity.extra.otz.modulesCompleted;
                    }
                });
                _this.clinicService.getOpportunisticInfectionsByClinic(_this.entity.id).subscribe(function (res) {
                    _this.oiList = res.map(function (co) { return co.opportunisticInfection; });
                });
            }
            else {
                _this.clinicService.adverseDrugReactions().subscribe(function (res) {
                    _this.adverseDrugReactions = res;
                    _this.adverseDrugReactions.forEach(function (adr) {
                        _this.selectedClinicAdr.push({
                            adverseDrugReaction: adr
                        });
                    });
                });
                _this.selectedClinicAdr = tslib_1.__spread(_this.selectedClinicAdr);
            }
        });
    };
    ClinicEditComponent.prototype.updateValue = function (event, cell, row) {
        console.log('Edit', event, cell, row);
        this.selectedClinicAdr = tslib_1.__spread(this.selectedClinicAdr.map(function (cadr) {
            if (cadr.adverseDrugReaction.id === row.id) {
                cadr.severity = event;
            }
            return cadr;
        }));
        console.log('UPDATED!', row, event);
    };
    ClinicEditComponent.prototype.filterDates = function (date) {
        var exists = false;
        this.visitDates.forEach(function (d) {
            if (date.diff(d, 'days') === 0) {
                exists = true;
            }
        });
        return (this.entity.id && date.diff(this.entity.dateVisit, 'days') === 0) || !exists;
    };
    ClinicEditComponent.prototype.dateChanged = function (date) {
        this.appointmentMax = date.clone().add(6, 'months');
        this.lmpMin = date.clone().subtract(2, 'years');
        this.appointmentMin = date.clone().add(14, 'days');
        this.otzApplicable = !date.clone().subtract(24, 'years').isAfter(this.entity.patient.dateBirth)
            && !date.clone().subtract(10, 'years').isBefore(this.entity.patient.dateBirth);
    };
    ClinicEditComponent.prototype.entityCompare = function (e1, e2) {
        return entityCompare(e1, e2);
    };
    ClinicEditComponent.prototype.previousState = function () {
        window.history.back();
    };
    ClinicEditComponent.prototype.save = function () {
        this.isSaving = true;
        var vm = {
            clinic: this.entity,
            adrList: this.selectedClinicAdr.filter(function (cadr) { return !!cadr.severity; }),
            oiList: this.oiList,
            adhereList: this.adhereList
        };
        if (!this.entity.extra) {
            this.entity.extra = {};
        }
        this.entity.extra.otz = {};
        if (!this.enrolledOnOTZ) {
            this.entity.extra.otz.dateEnrolledOnOTZ = null;
            this.entity.extra.otz.attendedLastOTZMeeting = null;
            this.entity.extra.otz.dateLastOTZMeeting = null;
            this.entity.extra.otz.enrolledOnOTZ = null;
            this.entity.extra.otz.caregiverPhone = null;
            this.entity.extra.otz.caregiverAddress = null;
            this.entity.extra.otz.modulesCompleted = null;
        }
        else {
            this.entity.extra.otz.dateEnrolledOnOTZ = this.dateEnrolledOnOTZ != null && this.dateEnrolledOnOTZ.isValid() ?
                this.dateEnrolledOnOTZ.format(DATE_FORMAT) : null;
            this.entity.extra.otz.attendedLastOTZMeeting = !!this.attendedLastOTZMeeting;
            this.entity.extra.otz.dateLastOTZMeeting = this.dateLastOTZMeeting != null && this.dateLastOTZMeeting.isValid() ?
                this.dateLastOTZMeeting.format(DATE_FORMAT) : null;
            this.entity.extra.otz.enrolledOnOTZ = this.enrolledOnOTZ;
            this.entity.extra.otz.caregiverPhone = this.caregiverPhone;
            this.entity.extra.otz.caregiverAddress = this.caregiverAddress;
            this.entity.extra.otz.modulesCompleted = this.modulesCompleted;
        }
        this.appLoaderService.open('Saving clinic visit..');
        if (this.entity.id !== undefined) {
            this.subscribeToSaveResponse(this.clinicService.update(vm));
        }
        else {
            this.subscribeToSaveResponse(this.clinicService.create(vm));
        }
    };
    ClinicEditComponent.prototype.regimenLineChange = function (type) {
        var _this = this;
        this.clinicService.getRegimenByLine(type.id).subscribe(function (res) { return _this.regimens = res; });
    };
    ClinicEditComponent.prototype.subscribeToSaveResponse = function (result) {
        var _this = this;
        result.subscribe(function (res) { return _this.onSaveSuccess(res.body); }, function (res) {
            _this.onSaveError();
            _this.onError(res.message);
        });
    };
    ClinicEditComponent.prototype.onSaveSuccess = function (result) {
        this.appLoaderService.close();
        this.isSaving = false;
        this.notification.showInfo('Clinic visit successfully saved');
        this.previousState();
    };
    ClinicEditComponent.prototype.onSaveError = function () {
        this.isSaving = false;
        this.appLoaderService.close();
        this.error = true;
        //this.submitButton.disabled = true;
        this.notification.showError('Error occurred saving clinic visit; try again');
        //this.progressBar.mode = 'determinate';
    };
    ClinicEditComponent.prototype.onError = function (errorMessage) {
        this.appLoaderService.close();
        this.notification.showError(errorMessage);
    };
    ClinicEditComponent.ctorParameters = function () { return [
        { type: ClinicService },
        { type: NotificationService },
        { type: ActivatedRoute },
        { type: AppLoaderService }
    ]; };
    ClinicEditComponent = tslib_1.__decorate([
        Component({
            selector: 'lamis-clinic-edit',
            template: "<div class=\"lamis-edit-form\">\r\n    <div class=\"lamis-edit-form-container\">\r\n        <form name=\"form\" role=\"form\" novalidate (ngSubmit)=\"save()\" #clinicForm=\"ngForm\">\r\n            <mat-card class=\"default\">\r\n                <mat-card-content>\r\n                    <ng-container *ngIf=\"commence === true\">\r\n                        <div>\r\n                            <mat-form-field class=\"full-width\">\r\n                                <input matInput [matDatepicker]=\"picker\"\r\n                                       placeholder=\"ART Start Date\"\r\n                                       [(ngModel)]=\"entity.dateVisit\"\r\n                                       #visit=\"ngModel\"\r\n                                       (dateChange)=\"dateChanged($event.value)\"\r\n                                       [matDatepickerFilter]=\"filterDates.bind(this)\"\r\n                                       [max]=\"today\"\r\n                                       [min]=\"dateRegistration\"\r\n                                       name=\"visit\"\r\n                                       required>\r\n                                <mat-datepicker-toggle\r\n                                        matSuffix\r\n                                        [for]=\"picker\">\r\n                                </mat-datepicker-toggle>\r\n                                <mat-datepicker #picker></mat-datepicker>\r\n                                <mat-error\r\n                                        *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.required)\">\r\n                                    ART Start Date is required\r\n                                </mat-error>\r\n                                <mat-error\r\n                                        *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.min)\">\r\n                                    Date of visit cannot be before {{dateRegistration | date: 'dd MMM, yyyy'}}\r\n                                </mat-error>\r\n                                <mat-error\r\n                                        *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.max)\">\r\n                                    ART Start Date cannot be in the future\r\n                                </mat-error>\r\n                            </mat-form-field>\r\n                        </div>\r\n                        <div class=\"row\">\r\n                            <div class=\"col-md-6\">\r\n                                <mat-form-field class=\"full-width\">\r\n                                    <input matInput placeholder=\"CD4 at start of ART\" [min]=\"0\" type=\"number\"\r\n                                           #cd4=\"ngModel\" name=\"cd4\" [(ngModel)]=\"entity.cd4\"/>\r\n                                    <mat-error\r\n                                            *ngIf=\"cd4.errors && (cd4.dirty || cd4.touched) && (cd4.errors.min)\">\r\n                                        Minimum CD4 is 0\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div class=\"col-md-6\">\r\n                                <mat-form-field class=\"full-width\">\r\n                                    <input matInput placeholder=\"CD4 %\" [min]=\"0\" [max]=\"100\" type=\"number\"\r\n                                           #cd4p=\"ngModel\" name=\"cd4p\" [(ngModel)]=\"entity.cd4p\"/>\r\n                                    <mat-error\r\n                                            *ngIf=\"cd4p.errors && (cd4p.dirty || cd4p.touched) && (cd4p.errors.min)\">\r\n                                        Minimum CD4 % is 0\r\n                                    </mat-error>\r\n                                    <mat-error\r\n                                            *ngIf=\"cd4p.errors && (cd4p.dirty || cd4p.touched) && (cd4p.errors.max)\">\r\n                                        Maximum CD4 % is 100\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"row\">\r\n                            <div class=\"col-md-6\">\r\n                                <mat-form-field class=\"full-width\">\r\n                                    <mat-select [(ngModel)]=\"entity.regimenType\"\r\n                                                placeholder=\"Original Regimen Line\"\r\n                                                #rtype=\"ngModel\" required name=\"rt\"\r\n                                                [compareWith]=\"entityCompare\"\r\n                                                (selectionChange)=\"regimenLineChange($event.value)\">\r\n                                        <mat-option>None</mat-option>\r\n                                        <mat-option *ngFor=\"let line of regimenLines\"\r\n                                                    [value]=\"line\">{{line.description}}</mat-option>\r\n                                        <mat-error\r\n                                                *ngIf=\"rtype.errors && (rtype.dirty || rtype.touched) && (rtype.errors.required)\">\r\n                                            Regimen Line is required\r\n                                        </mat-error>\r\n                                    </mat-select>\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div class=\"col-md-6\">\r\n                                <mat-form-field class=\"full-width\">\r\n                                    <mat-select [(ngModel)]=\"entity.regimen\"\r\n                                                placeholder=\"Original Regimen\"\r\n                                                [compareWith]=\"entityCompare\"\r\n                                                #rm=\"ngModel\" required name=\"rm\">\r\n                                        <mat-option>None</mat-option>\r\n                                        <mat-option *ngFor=\"let regimen of regimens\"\r\n                                                    [value]=\"regimen\">{{regimen.description}}</mat-option>\r\n                                        <mat-error\r\n                                                *ngIf=\"rm.errors && (rm.dirty || rm.touched) && (rm.errors.required)\">\r\n                                            Regimen is required\r\n                                        </mat-error>\r\n                                    </mat-select>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                        <ng-container *ngIf=\"otzApplicable\">\r\n                            <div class=\"row\">\r\n                                <div class=\"col-md-6\">\r\n                                    <mat-checkbox [(ngModel)]=\"enrolledOnOTZ\" name=\"otz\">\r\n                                        Enrolled on OTZ?\r\n                                    </mat-checkbox>\r\n                                </div>\r\n                                <div class=\"col-md-6\">\r\n                                    <mat-form-field class=\"full-width\" *ngIf=\"enrolledOnOTZ\">\r\n                                        <input matInput [matDatepicker]=\"picker7\"\r\n                                               placeholder=\"Date Enrolled on OTZ\"\r\n                                               [(ngModel)]=\"dateEnrolledOnOTZ\"\r\n                                               #otze=\"ngModel\"\r\n                                               [max]=\"today\"\r\n                                               [min]=\"entity.patient.dateBirth\"\r\n                                               name=\"otze\"\r\n                                               [required]=\"enrolledOnOTZ\">\r\n                                        <mat-datepicker-toggle\r\n                                                matSuffix\r\n                                                [for]=\"picker7\">\r\n                                        </mat-datepicker-toggle>\r\n                                        <mat-datepicker #picker7></mat-datepicker>\r\n                                        <mat-error\r\n                                                *ngIf=\"otze.errors && (otze.dirty || otze.touched) && (otze.errors.required)\">\r\n                                            Date enrolled on OTZ is required\r\n                                        </mat-error>\r\n                                        <mat-error\r\n                                                *ngIf=\"otze.errors && (otze.dirty || otze.touched) && (otze.errors.min)\">\r\n                                            Date enrolled on OTZ cannot be before date of\r\n                                            birth {{entity.patient.dateBirth | date: 'dd MMM, yyyy'}}\r\n                                        </mat-error>\r\n                                        <mat-error\r\n                                                *ngIf=\"otze.errors && (otze.dirty || otze.touched) && (otze.errors.max)\">\r\n                                            Date enrolled on OTZ cannot be in the future\r\n                                        </mat-error>\r\n                                    </mat-form-field>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"row\" *ngIf=\"enrolledOnOTZ\">\r\n                                <div class=\"col-md-6\">\r\n                                    <mat-form-field class=\"full-width\">\r\n                                        <mat-label>Caregiver Address</mat-label>\r\n                                        <input matInput name=\"phone\" [(ngModel)]=\"caregiverPhone\" #phone=\"ngModel\"\r\n                                               phoneNumber required/>\r\n                                        <mat-error\r\n                                                *ngIf=\"phone.errors && (phone.dirty || phone.touched) && (phone.errors.required)\">\r\n                                            Caregiver phone number is required\r\n                                        </mat-error>\r\n                                        <mat-error\r\n                                                *ngIf=\"phone.errors && (phone.dirty || phone.touched || !!entity.id) && (phone.errors.phoneNumber)\">\r\n                                            Invalid phone number\r\n                                        </mat-error>\r\n                                    </mat-form-field>\r\n                                </div>\r\n                                <div class=\"col-md-6\">\r\n                                    <mat-form-field class=\"full-width\">\r\n                                        <mat-label>Caregiver Address</mat-label>\r\n                                        <textarea matInput name=\"address\" [(ngModel)]=\"caregiverAddress\" #address=\"ngModel\"\r\n                                                  rows=\"2\" required>\r\n                                </textarea>\r\n                                        <mat-error\r\n                                                *ngIf=\"address.errors && (address.dirty || address.touched) && (address.errors.required)\">\r\n                                            Case Manager address is required\r\n                                        </mat-error>\r\n                                    </mat-form-field>\r\n                                </div>\r\n                            </div>\r\n                        </ng-container>\r\n                    </ng-container>\r\n                    <div *ngIf=\"commence === false || commence === undefined\">\r\n                        <mat-form-field class=\"full-width\">\r\n                            <input matInput [matDatepicker]=\"picker\"\r\n                                   placeholder=\"Date of Visit\"\r\n                                   [(ngModel)]=\"entity.dateVisit\"\r\n                                   [matDatepickerFilter]=\"filterDates.bind(this)\"\r\n                                   #visit=\"ngModel\"\r\n                                   (dateChange)=\"dateChanged($event.value)\"\r\n                                   [max]=\"today\"\r\n                                   [min]=\"dateRegistration\"\r\n                                   name=\"visit\"\r\n                                   required>\r\n                            <mat-datepicker-toggle\r\n                                    matSuffix\r\n                                    [for]=\"picker\">\r\n                            </mat-datepicker-toggle>\r\n                            <mat-datepicker #picker></mat-datepicker>\r\n                            <mat-error\r\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.required)\">\r\n                                Date of visit is required\r\n                            </mat-error>\r\n                            <mat-error\r\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.min)\">\r\n                                Date of visit cannot be before {{dateRegistration | date: 'dd MMM, yyyy'}}\r\n                            </mat-error>\r\n                            <mat-error\r\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.max)\">\r\n                                Date of visit cannot be in the future\r\n                            </mat-error>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div>\r\n                        <mat-form-field class=\"full-width\">\r\n                            <mat-select [(ngModel)]=\"entity.clinicStage\"\r\n                                        placeholder=\"Clinical Stage\"\r\n                                        #clinicStage=\"ngModel\" name=\"cs\">\r\n                                <mat-option>None</mat-option>\r\n                                <mat-option [value]=\"'Stage I'\">Stage I</mat-option>\r\n                                <mat-option [value]=\"'Stage II'\">Stage II</mat-option>\r\n                                <mat-option [value]=\"'Stage III'\">Stage III</mat-option>\r\n                                <mat-option [value]=\"'Stage IV'\">Stage IV</mat-option>\r\n                            </mat-select>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div>\r\n                        <mat-form-field class=\"full-width\">\r\n                            <mat-select [(ngModel)]=\"entity.funcStatus\"\r\n                                        placeholder=\"Functional Status\"\r\n                                        #funcStatus=\"ngModel\" name=\"fs\">\r\n                                <mat-option>None</mat-option>\r\n                                <mat-option [value]=\"'Working'\">Working</mat-option>\r\n                                <mat-option [value]=\"'Ambulatory'\">Ambulatory</mat-option>\r\n                                <mat-option [value]=\"'Bedridden'\">Bedridden</mat-option>\r\n                            </mat-select>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div>\r\n                        <mat-form-field class=\"full-width\">\r\n                            <mat-select [(ngModel)]=\"entity.tbStatus\"\r\n                                        placeholder=\"TB Status\"\r\n                                        name=\"tb\"\r\n                                        #tbStatus=\"ngModel\">\r\n                                <mat-option>None</mat-option>\r\n                                <mat-option [value]=\"'No sign or symptoms of TB'\">No sign or symptoms of TB</mat-option>\r\n                                <mat-option [value]=\"'TB suspected and referred for evaluation'\">TB suspected and\r\n                                    referred\r\n                                    for evaluation\r\n                                </mat-option>\r\n                                <mat-option [value]=\"'Currently on INH prophylaxis'\">Currently on INH prophylaxis\r\n                                </mat-option>\r\n                                <mat-option [value]=\"'Currently on TB treatment'\">Currently on TB treatment</mat-option>\r\n                                <mat-option [value]=\"'TB positive not on TB drugs'\">TB positive not on TB drugs\r\n                                </mat-option>\r\n                            </mat-select>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div>\r\n                        <mat-form-field class=\"full-width\">\r\n                            <input matInput placeholder=\"Body weight(Kg)\" [min]=\"0\" [max]=\"250\" type=\"number\"\r\n                                   #weight=\"ngModel\" name=\"weight\" [(ngModel)]=\"entity.bodyWeight\"/>\r\n                            <mat-error\r\n                                    *ngIf=\"weight.errors && (weight.dirty || weight.touched) && (weight.errors.min)\">\r\n                                Minimum body weight is 0\r\n                            </mat-error>\r\n                            <mat-error\r\n                                    *ngIf=\"weight.errors && (weight.dirty || weight.touched) && (weight.errors.max)\">\r\n                                Maximum body weight is 250\r\n                            </mat-error>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div>\r\n                        <mat-form-field class=\"full-width\">\r\n                            <input matInput placeholder=\"Height (m)\" [min]=\"0\" [max]=\"1.8\" type=\"number\"\r\n                                   #height=\"ngModel\" name=\"height\" [(ngModel)]=\"entity.height\"/>\r\n                            <mat-error\r\n                                    *ngIf=\"height.errors && (height.dirty || height.touched) && (height.errors.min)\">\r\n                                Minimum height is 0\r\n                            </mat-error>\r\n                            <mat-error\r\n                                    *ngIf=\"height.errors && (height.dirty || height.touched) && (height.errors.max)\">\r\n                                Maximum height is 1.8m\r\n                            </mat-error>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <fieldset>\r\n                        <h6>Blood Pressure(mmHg)</h6>\r\n                        <div class=\"row\">\r\n                            <div class=\"col-md-3\">\r\n                                <mat-form-field class=\"full-width\">\r\n                                    <input matInput placeholder=\"Systolic\"\r\n                                           name=\"bp1\" type=\"number\"\r\n                                           [max]=\"190\"\r\n                                           [min]=\"70\"\r\n                                           [required]=\"!!entity.bp2\"\r\n                                           #bp1=\"ngModel\" [(ngModel)]=\"entity.bp1\"/>\r\n                                    <mat-error\r\n                                            *ngIf=\"bp1.errors && (bp1.dirty || bp1.touched) && (bp1.errors.max)\">\r\n                                        Maximum Systolic is 190\r\n                                    </mat-error>\r\n                                    <mat-error\r\n                                            *ngIf=\"bp1.errors && (bp1.dirty || bp1.touched) && (bp1.errors.min)\">\r\n                                        Minimum Systolic is 70\r\n                                    </mat-error>\r\n                                    <mat-error\r\n                                            *ngIf=\"bp1.errors && (bp1.dirty || bp1.touched) && (bp1.errors.required)\">\r\n                                        Systolic is required\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n                            </div>\r\n                            <div class=\"col-md-3\">\r\n                                <mat-form-field class=\"full-width\">\r\n                                    <input matInput placeholder=\"Diastolic\"\r\n                                           name=\"bp2\" type=\"number\"\r\n                                           [max]=\"100\"\r\n                                           [min]=\"40\"\r\n                                           [required]=\"!!entity.bp1\"\r\n                                           #bp2=\"ngModel\" [(ngModel)]=\"entity.bp2\"/>\r\n                                    <mat-error\r\n                                            *ngIf=\"bp2.errors && (bp2.dirty || bp2.touched) && (bp2.errors.max)\">\r\n                                        Maximum Diastolic is 100\r\n                                    </mat-error>\r\n                                    <mat-error\r\n                                            *ngIf=\"bp2.errors && (bp2.dirty || bp2.touched) && (bp2.errors.min)\">\r\n                                        Minimum Diastolic is 40\r\n                                    </mat-error>\r\n                                    <mat-error\r\n                                            *ngIf=\"bp2.errors && (bp2.dirty || bp2.touched) && (bp2.errors.required)\">\r\n                                        Diastolic is required\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                    </fieldset>\r\n                    <div *ngIf=\"entity.patient && entity.patient.gender === 'FEMALE'\">\r\n                        <mat-form-field class=\"full-width\">\r\n                            <mat-select [(ngModel)]=\"entity.pregnancyStatus\"\r\n                                        placeholder=\"Pregnancy Status\"\r\n                                        #pregStatus=\"ngModel\" name=\"ps\">\r\n                                <mat-option>None</mat-option>\r\n                                <mat-option [value]=\"1\">Not Pregnant</mat-option>\r\n                                <mat-option [value]=\"2\">Pregnant</mat-option>\r\n                                <mat-option [value]=\"3\">Breastfeeding</mat-option>\r\n                            </mat-select>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div *ngIf=\"entity.patient && entity.patient.gender === 'FEMALE' && lmpMin\">\r\n                        <mat-form-field class=\"full-width\">\r\n                            <input matInput [matDatepicker]=\"picker1\"\r\n                                   placeholder=\"LMP\"\r\n                                   [(ngModel)]=\"entity.lmp\"\r\n                                   #lmp=\"ngModel\"\r\n                                   [max]=\"entity.dateVisit\"\r\n                                   [min]=\"lmpMin\"\r\n                                   name=\"lmp\">\r\n                            <mat-datepicker-toggle\r\n                                    matSuffix\r\n                                    [for]=\"picker1\">\r\n                            </mat-datepicker-toggle>\r\n                            <mat-datepicker #picker1></mat-datepicker>\r\n                            <mat-error\r\n                                    *ngIf=\"lmp.errors && (lmp.dirty || lmp.touched) && (lmp.errors.max)\">\r\n                                LMP cannot be after {{entity.dateVisit | date: 'dd MMM, yyyy'}}\r\n                            </mat-error>\r\n                            <mat-error\r\n                                    *ngIf=\"lmp.errors && (lmp.dirty || lmp.touched) && (lmp.errors.min)\">\r\n                                LMP cannot be before {{lmpMin | date: 'dd MMM, yyyy'}}\r\n                            </mat-error>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div>\r\n                        <mat-form-field class=\"full-width\">\r\n                            <mat-select [(ngModel)]=\"oiList\"\r\n                                        placeholder=\"Opportunistic Infections\"\r\n                                        [compareWith]=\"entityCompare\"\r\n                                        name=\"ois\"\r\n                                        #oiIds=\"ngModel\" multiple>\r\n                                <mat-option>None</mat-option>\r\n                                <mat-option *ngFor=\"let oi of opportunisticInfections\"\r\n                                            [value]=\"oi\">{{oi.description}}</mat-option>\r\n                            </mat-select>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div class=\"row\">\r\n                        <div class=\"col-md-4\">\r\n                            <mat-checkbox [(ngModel)]=\"adr\"\r\n                                          name=\"ad\">Adverse Drug Reaction Screened?\r\n                            </mat-checkbox>\r\n                        </div>\r\n                        <div style=\"height: 300px; overflow-y: auto;\" *ngIf=\"adr\" class=\"col-md-8\">\r\n                            <adf-datatable [rows]=\"selectedClinicAdr\"\r\n                                           [stickyHeader]=\"true\">\r\n                                <data-columns>\r\n                                    <data-column key=\"adverseDrugReaction.description\" title=\"Description\"\r\n                                                 sortable=\"true\"></data-column>\r\n                                    <data-column key=\"severity\" title=\"Severity\" sortable=\"false\">\r\n                                        <ng-template let-context=\"$implicit\">\r\n                                            <mat-form-field class=\"full-width\">\r\n                                                <mat-select autofocus\r\n                                                            [value]=\"context.row.getValue('severity')\"\r\n                                                            name=\"severity\"\r\n                                                            (valueChange)=\"updateValue($event, 'severity', context.row.getValue('adverseDrugReaction'))\">\r\n                                                    <mat-option>None</mat-option>\r\n                                                    <mat-option [value]=\"'Grade 1'\">Grade 1</mat-option>\r\n                                                    <mat-option [value]=\"'Grade 2'\">Grade 2</mat-option>\r\n                                                    <mat-option [value]=\"'Grade 3'\">Grade 3</mat-option>\r\n                                                    <mat-option [value]=\"'Grade 4'\">Grade 4</mat-option>\r\n                                                </mat-select>\r\n                                            </mat-form-field>\r\n                                        </ng-template>\r\n                                    </data-column>\r\n                                </data-columns>\r\n                            </adf-datatable>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"row\">\r\n                        <div class=\"col-md-6\">\r\n                            <mat-form-field class=\"full-width\">\r\n                                <mat-select [(ngModel)]=\"entity.adherenceLevel\"\r\n                                            placeholder=\"Level of Adherence\"\r\n                                            #adherence=\"ngModel\" name=\"al\">\r\n                                    <mat-option>None</mat-option>\r\n                                    <mat-option [value]=\"'Good'\">Good</mat-option>\r\n                                    <mat-option [value]=\"'Fair'\">Fair</mat-option>\r\n                                    <mat-option [value]=\"'Poor'\">Poor</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </div>\r\n                        <div class=\"col-md-6\">\r\n                            <mat-form-field class=\"full-width\"\r\n                                            *ngIf=\"entity.adherenceLevel === 'Fair' || entity.adherenceLevel === 'Poor'\">\r\n                                <mat-select [(ngModel)]=\"adhereList\"\r\n                                            placeholder=\"Adherence\"\r\n                                            name=\"ads\"\r\n                                            [compareWith]=\"entityCompare\"\r\n                                            #adrIds=\"ngModel\" multiple>\r\n                                    <mat-option>None</mat-option>\r\n                                    <mat-option *ngFor=\"let adhere of adheres\"\r\n                                                [value]=\"adhere\">{{adhere.description}}</mat-option>\r\n                                </mat-select>\r\n                            </mat-form-field>\r\n                        </div>\r\n                    </div>\r\n                    <ng-container *ngIf=\"otzApplicable || enrolledOnOTZ\">\r\n                        <div class=\"row\">\r\n                            <div class=\"col-md-6\">\r\n                                <mat-checkbox [(ngModel)]=\"attendedLastOTZMeeting\" name=\"aotz\">\r\n                                    Attended last support group (OTZ club) meeting?\r\n                                </mat-checkbox>\r\n                            </div>\r\n                            <div class=\"col-md-6\">\r\n                                <mat-form-field class=\"full-width\" *ngIf=\"attendedLastOTZMeeting\">\r\n                                    <input matInput [matDatepicker]=\"picker8\"\r\n                                           placeholder=\"Date of Last OTZ Club Meeting\"\r\n                                           [(ngModel)]=\"dateLastOTZMeeting\"\r\n                                           #lotzm=\"ngModel\"\r\n                                           [max]=\"today\"\r\n                                           [min]=\"dateEnrolledOnOTZ\"\r\n                                           name=\"lotzm\"\r\n                                           [required]=\"attendedLastOTZMeeting\">\r\n                                    <mat-datepicker-toggle\r\n                                            matSuffix\r\n                                            [for]=\"picker8\">\r\n                                    </mat-datepicker-toggle>\r\n                                    <mat-datepicker #picker8></mat-datepicker>\r\n                                    <mat-error\r\n                                            *ngIf=\"lotzm.errors && (lotzm.dirty || lotzm.touched) && (lotzm.errors.required)\">\r\n                                        Date of Last OTZ meeting is required\r\n                                    </mat-error>\r\n                                    <mat-error\r\n                                            *ngIf=\"lotzm.errors && (lotzm.dirty || lotzm.touched) && (lotzm.errors.min)\">\r\n                                        Date of last OTZ meeting cannot be\r\n                                        before {{dateEnrolledOnOTZ | date: 'dd MMM, yyyy'}}\r\n                                    </mat-error>\r\n                                    <mat-error\r\n                                            *ngIf=\"lotzm.errors && (lotzm.dirty || lotzm.touched) && (lotzm.errors.max)\">\r\n                                        Date of last OTZ meeting cannot be in the future\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"row\">\r\n                            <div class=\"col-md-6\">\r\n                                <mat-form-field class=\"full-width\">\r\n                                    <mat-select name=\"modules\" [(ngModel)]=\"modulesCompleted\" #modules=\"ngModel\"\r\n                                                [required]=\"attendedLastOTZMeeting\">\r\n                                        <mat-option></mat-option>\r\n                                        <mat-option [value]=\"1\">1</mat-option>\r\n                                        <mat-option [value]=\"2\">2</mat-option>\r\n                                        <mat-option [value]=\"3\">3</mat-option>\r\n                                        <mat-option [value]=\"4\">4</mat-option>\r\n                                        <mat-option [value]=\"5\">5</mat-option>\r\n                                        <mat-option [value]=\"6\">6</mat-option>\r\n                                        <mat-option [value]=\"7\">7</mat-option>\r\n                                    </mat-select>\r\n                                    <mat-error\r\n                                            *ngIf=\"modules.errors && (modules.dirty || modules.touched) && (modules.errors.required)\">\r\n                                        Number of modules attended required\r\n                                    </mat-error>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </div>\r\n                    </ng-container>\r\n                    <div *ngIf=\"!!appointmentMin\">\r\n                        <mat-form-field class=\"full-width\">\r\n                            <input matInput [matDatepicker]=\"picker2\"\r\n                                   placeholder=\"Date of Next Appointment\"\r\n                                   [(ngModel)]=\"entity.nextAppointment\"\r\n                                   #na=\"ngModel\"\r\n                                   [min]=\"appointmentMin\"\r\n                                   [max]=\"appointmentMax\"\r\n                                   name=\"na\"\r\n                                   required>\r\n                            <mat-datepicker-toggle\r\n                                    matSuffix\r\n                                    [for]=\"picker2\">\r\n                            </mat-datepicker-toggle>\r\n                            <mat-datepicker #picker2></mat-datepicker>\r\n                            <mat-error\r\n                                    *ngIf=\"na.errors && (na.dirty || na.touched) && (na.errors.required)\">\r\n                                Date of next appointment is required\r\n                            </mat-error>\r\n                            <mat-error\r\n                                    *ngIf=\"na.errors && (na.dirty || na.touched) && (na.errors.max)\">\r\n                                Date of next appointment cannot be after {{appointmentMax | date: 'dd MMM, yyyy'}}\r\n                            </mat-error>\r\n                            <mat-error\r\n                                    *ngIf=\"na.errors && (na.dirty || na.touched) && (na.errors.min)\">\r\n                                Date of next appointment cannot be before {{appointmentMin | date: 'dd MMM, yyyy'}}\r\n                            </mat-error>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <div>\r\n                        <mat-form-field class=\"full-width\">\r\n                            <textarea matInput placeholder=\"Clinical Notes\"\r\n                                      cols=\"30\"\r\n                                      rows=\"3\"\r\n                                      name=\"notes\"\r\n                                      #note=\"ngModel\" [(ngModel)]=\"entity.notes\"></textarea>\r\n                        </mat-form-field>\r\n                    </div>\r\n                    <mat-card-actions class=\"lamis-edit-form-actions\">\r\n                        <button mat-raised-button type=\"button\" (click)=\"previousState()\">Back</button>\r\n                        <button mat-raised-button color='primary'\r\n                                [disabled]=\"clinicForm.invalid || isSaving\"\r\n                                type=\"submit\">\r\n                            {{entity.id !== undefined ? 'Update' : 'Save'}}\r\n                        </button>\r\n                    </mat-card-actions>\r\n                </mat-card-content>\r\n            </mat-card>\r\n        </form>\r\n    </div>\r\n</div>\r\n"
        }),
        tslib_1.__metadata("design:paramtypes", [ClinicService,
            NotificationService,
            ActivatedRoute,
            AppLoaderService])
    ], ClinicEditComponent);
    return ClinicEditComponent;
}());
export { ClinicEditComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpbmljLWVkaXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbGFtaXMtY2xpbmljLTEuMi4wLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvY2xpbmljL2NsaW5pYy1lZGl0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQVNsRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDOUQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBR2pELE9BQU8sS0FBSyxPQUFPLE1BQU0sUUFBUSxDQUFDO0FBRWxDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxXQUFXLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0UsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBRXJELElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQztBQU12QjtJQWlDSSw2QkFBb0IsYUFBNEIsRUFDMUIsWUFBaUMsRUFDakMsY0FBOEIsRUFDaEMsZ0JBQWtDO1FBSGxDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzFCLGlCQUFZLEdBQVosWUFBWSxDQUFxQjtRQUNqQyxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDaEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQS9CdEQsVUFBSyxHQUFHLEtBQUssQ0FBQztRQUVkLFVBQUssR0FBRyxNQUFNLEVBQUUsQ0FBQztRQVdqQixlQUFVLEdBQWEsRUFBRSxDQUFDO1FBQzFCLHNCQUFpQixHQUFnQyxFQUFFLENBQUM7UUFDcEQsV0FBTSxHQUE2QixFQUFFLENBQUM7UUFDdEMsZUFBVSxHQUFhLEVBQUUsQ0FBQztRQUMxQixlQUFVLEdBQUcsVUFBVSxDQUFDO1FBQ3hCLFFBQUcsR0FB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Q0FBTyxHQUFqQixVQUFrQixZQUFvQjtRQUNsQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDOUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDOUMsQ0FBQzs7Z0JBM09rQyxhQUFhO2dCQUNaLG1CQUFtQjtnQkFDakIsY0FBYztnQkFDZCxnQkFBZ0I7O0lBcEM3QyxtQkFBbUI7UUFKL0IsU0FBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLG1CQUFtQjtZQUM3QixtdW9DQUEyQztTQUM5QyxDQUFDO2lEQWtDcUMsYUFBYTtZQUNaLG1CQUFtQjtZQUNqQixjQUFjO1lBQ2QsZ0JBQWdCO09BcEM3QyxtQkFBbUIsQ0E2US9CO0lBQUQsMEJBQUM7Q0FBQSxBQTdRRCxJQTZRQztTQTdRWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1xyXG4gICAgQWRoZXJlLFxyXG4gICAgQWR2ZXJzZURydWdSZWFjdGlvbixcclxuICAgIENsaW5pYyxcclxuICAgIENsaW5pY0FkdmVyc2VEcnVnUmVhY3Rpb24sXHJcbiAgICBDbGluaWNWbSxcclxuICAgIE9wcG9ydHVuaXN0aWNJbmZlY3Rpb25cclxufSBmcm9tICcuLi8uLi9tb2RlbC9jbGluaWMubW9kZWwnO1xyXG5pbXBvcnQgeyBDbGluaWNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvY2xpbmljLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBOb3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcclxuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSwgSHR0cFJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCAqIGFzIG1vbWVudF8gZnJvbSAnbW9tZW50JztcclxuaW1wb3J0IHsgTW9tZW50IH0gZnJvbSAnbW9tZW50JztcclxuaW1wb3J0IHsgQXBwTG9hZGVyU2VydmljZSwgREFURV9GT1JNQVQsIGVudGl0eUNvbXBhcmUgfSBmcm9tICdAbGFtaXMvd2ViLWNvcmUnO1xyXG5pbXBvcnQgeyBDb2x1bW5Nb2RlIH0gZnJvbSAnQHN3aW1sYW5lL25neC1kYXRhdGFibGUnO1xyXG5cclxuY29uc3QgbW9tZW50ID0gbW9tZW50XztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdsYW1pcy1jbGluaWMtZWRpdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vY2xpbmljLWVkaXQuY29tcG9uZW50Lmh0bWwnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDbGluaWNFZGl0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIC8vQFZpZXdDaGlsZChNYXRQcm9ncmVzc0Jhciwge3N0YXRpYzogdHJ1ZX0pIHByb2dyZXNzQmFyOiBNYXRQcm9ncmVzc0JhcjtcclxuICAgIC8vQFZpZXdDaGlsZChNYXRCdXR0b24sIHtzdGF0aWM6IHRydWV9KSBzdWJtaXRCdXR0b246IE1hdEJ1dHRvbjtcclxuICAgIGVudGl0eTogQ2xpbmljO1xyXG4gICAgaXNTYXZpbmc6IGJvb2xlYW47XHJcbiAgICBlcnJvciA9IGZhbHNlO1xyXG4gICAgY29tbWVuY2U6IGFueTtcclxuICAgIHRvZGF5ID0gbW9tZW50KCk7XHJcbiAgICBsbXBNaW46IE1vbWVudDtcclxuICAgIGFwcG9pbnRtZW50TWF4OiBNb21lbnQ7XHJcbiAgICBhcHBvaW50bWVudE1pbjogTW9tZW50O1xyXG4gICAgb3Bwb3J0dW5pc3RpY0luZmVjdGlvbnM6IE9wcG9ydHVuaXN0aWNJbmZlY3Rpb25bXTtcclxuICAgIGFkdmVyc2VEcnVnUmVhY3Rpb25zOiBBZHZlcnNlRHJ1Z1JlYWN0aW9uW107XHJcbiAgICBhZGhlcmVzOiBBZGhlcmVbXTtcclxuICAgIHJlZ2ltZW5MaW5lczogYW55W107XHJcbiAgICByZWdpbWVuczogYW55W107XHJcbiAgICBkYXRlQmlydGg6IE1vbWVudDtcclxuICAgIGRhdGVSZWdpc3RyYXRpb246IE1vbWVudDtcclxuICAgIHZpc2l0RGF0ZXM6IE1vbWVudFtdID0gW107XHJcbiAgICBzZWxlY3RlZENsaW5pY0FkcjogQ2xpbmljQWR2ZXJzZURydWdSZWFjdGlvbltdID0gW107XHJcbiAgICBvaUxpc3Q6IE9wcG9ydHVuaXN0aWNJbmZlY3Rpb25bXSA9IFtdO1xyXG4gICAgYWRoZXJlTGlzdDogQWRoZXJlW10gPSBbXTtcclxuICAgIENvbHVtbk1vZGUgPSBDb2x1bW5Nb2RlO1xyXG4gICAgYWRyID0gZmFsc2U7XHJcbiAgICBlbnJvbGxlZE9uT1RaOiBib29sZWFuO1xyXG4gICAgZGF0ZUVucm9sbGVkT25PVFo6IE1vbWVudDtcclxuICAgIGF0dGVuZGVkTGFzdE9UWk1lZXRpbmc6IGJvb2xlYW47XHJcbiAgICBkYXRlTGFzdE9UWk1lZXRpbmc6IE1vbWVudDtcclxuICAgIG1vZHVsZXNDb21wbGV0ZWQ6IG51bWJlcjtcclxuICAgIGNhcmVnaXZlclBob25lOiBzdHJpbmc7XHJcbiAgICBjYXJlZ2l2ZXJBZGRyZXNzOiBzdHJpbmc7XHJcbiAgICBvdHpBcHBsaWNhYmxlID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjbGluaWNTZXJ2aWNlOiBDbGluaWNTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIG5vdGlmaWNhdGlvbjogTm90aWZpY2F0aW9uU2VydmljZSxcclxuICAgICAgICAgICAgICAgIHByb3RlY3RlZCBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFwcExvYWRlclNlcnZpY2U6IEFwcExvYWRlclNlcnZpY2UpIHtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVFbnRpdHkoKTogQ2xpbmljIHtcclxuICAgICAgICByZXR1cm4gPENsaW5pYz57fTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmNsaW5pY1NlcnZpY2Uub3Bwb3J0dW5pc3RpY0luZmVjdGlvbnMoKS5zdWJzY3JpYmUocmVzID0+IHRoaXMub3Bwb3J0dW5pc3RpY0luZmVjdGlvbnMgPSByZXMpO1xyXG4gICAgICAgIHRoaXMuY2xpbmljU2VydmljZS5hZGhlcmVzKCkuc3Vic2NyaWJlKHJlcyA9PiB0aGlzLmFkaGVyZXMgPSByZXMpO1xyXG4gICAgICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNsaW5pY1NlcnZpY2UuZ2V0UmVnaW1lbkxpbmVzKCkuc3Vic2NyaWJlKHJlcyA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVnaW1lbkxpbmVzID0gcmVzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuYWN0aXZhdGVkUm91dGUuZGF0YS5zdWJzY3JpYmUoKHtlbnRpdHl9KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tbWVuY2UgPSAhIXRoaXMuYWN0aXZhdGVkUm91dGUuc25hcHNob3QuZGF0YVsnY29tbWVuY2UnXTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5ID0gISFlbnRpdHkgJiYgZW50aXR5LmJvZHkgPyBlbnRpdHkuYm9keSA6IGVudGl0eTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZW50aXR5ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZW50aXR5ID0gdGhpcy5jcmVhdGVFbnRpdHkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBwYXRpZW50SWQgPSB0aGlzLmFjdGl2YXRlZFJvdXRlLnNuYXBzaG90LnBhcmFtTWFwLmdldCgncGF0aWVudElkJyk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNsaW5pY1NlcnZpY2UuZ2V0UGF0aWVudChwYXRpZW50SWQpLnN1YnNjcmliZSgocmVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVudGl0eS5wYXRpZW50ID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkuZmFjaWxpdHkgPSByZXMuZmFjaWxpdHk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGVCaXJ0aCA9IHJlcy5kYXRlQmlydGg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGVSZWdpc3RyYXRpb24gPSByZXMuZGF0ZVJlZ2lzdHJhdGlvbjtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsaW5pY1NlcnZpY2UuZW5yb2xsZWRPbk9UWihyZXMuaWQpLnN1YnNjcmliZShyID0+IHRoaXMuZW5yb2xsZWRPbk9UWiA9IHIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5wYXRpZW50LnN0YXR1c0F0UmVnaXN0cmF0aW9uID09PSAnQVJUX1RSQU5TRkVSX0lOJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0ZVJlZ2lzdHJhdGlvbiA9IHRoaXMuZW50aXR5LnBhdGllbnQuZGF0ZVJlZ2lzdHJhdGlvbi5jbG9uZSgpLnN1YnRyYWN0KDEwLCAneWVhcnMnKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kYXRlUmVnaXN0cmF0aW9uLmlzQmVmb3JlKHRoaXMuZW50aXR5LnBhdGllbnQuZGF0ZUJpcnRoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGVSZWdpc3RyYXRpb24gPSB0aGlzLmVudGl0eS5wYXRpZW50LmRhdGVCaXJ0aC5jbG9uZSgpLmFkZCgzLCAnbW9udGhzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMub3R6QXBwbGljYWJsZSA9ICFtb21lbnQoKS5zdWJ0cmFjdCgyNCwgJ3llYXJzJykuaXNBZnRlcih0aGlzLmVudGl0eS5wYXRpZW50LmRhdGVCaXJ0aClcclxuICAgICAgICAgICAgICAgICAgICAmJiAhbW9tZW50KCkuc3VidHJhY3QoMTAsICd5ZWFycycpLmlzQmVmb3JlKHRoaXMuZW50aXR5LnBhdGllbnQuZGF0ZUJpcnRoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsaW5pY1NlcnZpY2UuZ2V0VmlzaXREYXRlc0J5UGF0aWVudCh0aGlzLmVudGl0eS5wYXRpZW50LmlkKS5zdWJzY3JpYmUoKHJlcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlzaXREYXRlcyA9IHJlcztcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZW50aXR5LmNvbW1lbmNlICYmIHRoaXMuZW50aXR5LnJlZ2ltZW5UeXBlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlZ2ltZW5MaW5lQ2hhbmdlKHRoaXMuZW50aXR5LnJlZ2ltZW5UeXBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNvbW1lbmNlID0gdGhpcy5jb21tZW5jZSB8fCB0aGlzLmVudGl0eS5jb21tZW5jZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbW1lbmNlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVudGl0eS5jb21tZW5jZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbnRpdHkucmVnaW1lblR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2ltZW5MaW5lQ2hhbmdlKHRoaXMuZW50aXR5LnJlZ2ltZW5UeXBlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZW50aXR5LmlkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcG9pbnRtZW50TWluID0gdGhpcy5lbnRpdHkuZGF0ZVZpc2l0LmNsb25lKCkuYWRkKDE0LCAnZGF5cycpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hcHBvaW50bWVudE1heCA9IHRoaXMuZW50aXR5LmRhdGVWaXNpdC5jbG9uZSgpLmFkZCg2LCAnbW9udGhzJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsaW5pY1NlcnZpY2UuZ2V0QWRoZXJlQnlDbGluaWModGhpcy5lbnRpdHkuaWQpLnN1YnNjcmliZSgocmVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGhlcmVMaXN0ID0gcmVzLm1hcChjYSA9PiBjYS5hZGhlcmUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsaW5pY1NlcnZpY2UuYWR2ZXJzZURydWdSZWFjdGlvbnMoKS5zdWJzY3JpYmUocmVzMSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZHZlcnNlRHJ1Z1JlYWN0aW9ucyA9IHJlczE7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGluaWNTZXJ2aWNlLmdldEFkdmVyc2VEcnVnUmVhY3Rpb25zQnlDbGluaWModGhpcy5lbnRpdHkuaWQpLnN1YnNjcmliZShyZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmJvZHkgJiYgcmVzLmJvZHkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZHIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWR2ZXJzZURydWdSZWFjdGlvbnMuZm9yRWFjaChhZHIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmJvZHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuYm9keS5mb3JFYWNoKGNhZHIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2Fkci5hZHZlcnNlRHJ1Z1JlYWN0aW9uLmlkID09PSBhZHIuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDbGluaWNBZHIucHVzaChjYWRyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENsaW5pY0Fkci5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2ZXJzZURydWdSZWFjdGlvbjogYWRyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDbGluaWNBZHIgPSBbLi4udGhpcy5zZWxlY3RlZENsaW5pY0Fkcl07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5leHRyYSAmJiB0aGlzLmVudGl0eS5leHRyYS5vdHopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdHRlbmRlZExhc3RPVFpNZWV0aW5nID0gISF0aGlzLmVudGl0eS5leHRyYS5vdHouYXR0ZW5kZWRMYXN0T1RaTWVldGluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbnJvbGxlZE9uT1RaID0gISF0aGlzLmVudGl0eS5leHRyYS5vdHouZW5yb2xsZWRPbk9UWjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEhdGhpcy5lbnRpdHkuZXh0cmEub3R6LmRhdGVFbnJvbGxlZE9uT1RaKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGVFbnJvbGxlZE9uT1RaID0gbW9tZW50KHRoaXMuZW50aXR5LmV4dHJhLm90ei5kYXRlRW5yb2xsZWRPbk9UWik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIXRoaXMuZW50aXR5LmV4dHJhLm90ei5kYXRlTGFzdE9UWk1lZXRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0ZUxhc3RPVFpNZWV0aW5nID0gbW9tZW50KHRoaXMuZW50aXR5LmV4dHJhLm90ei5kYXRlTGFzdE9UWk1lZXRpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FyZWdpdmVyUGhvbmUgPSB0aGlzLmVudGl0eS5leHRyYS5vdHouY2FyZWdpdmVyUGhvbmU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FyZWdpdmVyQWRkcmVzcyA9IHRoaXMuZW50aXR5LmV4dHJhLm90ei5jYXJlZ2l2ZXJBZGRyZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZHVsZXNDb21wbGV0ZWQgPSB0aGlzLmVudGl0eS5leHRyYS5vdHoubW9kdWxlc0NvbXBsZXRlZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xpbmljU2VydmljZS5nZXRPcHBvcnR1bmlzdGljSW5mZWN0aW9uc0J5Q2xpbmljKHRoaXMuZW50aXR5LmlkKS5zdWJzY3JpYmUocmVzID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9pTGlzdCA9IHJlcy5tYXAoY28gPT4gY28ub3Bwb3J0dW5pc3RpY0luZmVjdGlvbilcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsaW5pY1NlcnZpY2UuYWR2ZXJzZURydWdSZWFjdGlvbnMoKS5zdWJzY3JpYmUocmVzID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkdmVyc2VEcnVnUmVhY3Rpb25zID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWR2ZXJzZURydWdSZWFjdGlvbnMuZm9yRWFjaChhZHIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2xpbmljQWRyLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2ZXJzZURydWdSZWFjdGlvbjogYWRyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2xpbmljQWRyID0gWy4uLnRoaXMuc2VsZWN0ZWRDbGluaWNBZHJdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlVmFsdWUoZXZlbnQsIGNlbGwsIHJvdzogQ2xpbmljQWR2ZXJzZURydWdSZWFjdGlvbikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdFZGl0JywgZXZlbnQsIGNlbGwsIHJvdyk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZENsaW5pY0FkciA9IFsuLi50aGlzLnNlbGVjdGVkQ2xpbmljQWRyLm1hcChjYWRyID0+IHtcclxuICAgICAgICAgICAgaWYgKGNhZHIuYWR2ZXJzZURydWdSZWFjdGlvbi5pZCA9PT0gcm93LmlkKSB7XHJcbiAgICAgICAgICAgICAgICBjYWRyLnNldmVyaXR5ID0gZXZlbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNhZHI7XHJcbiAgICAgICAgfSldO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdVUERBVEVEIScsIHJvdywgZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBmaWx0ZXJEYXRlcyhkYXRlOiBNb21lbnQpOiBib29sZWFuIHtcclxuICAgICAgICBsZXQgZXhpc3RzID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHRoaXMudmlzaXREYXRlcy5mb3JFYWNoKGQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGF0ZS5kaWZmKGQsICdkYXlzJykgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gKHRoaXMuZW50aXR5LmlkICYmIGRhdGUuZGlmZih0aGlzLmVudGl0eS5kYXRlVmlzaXQsICdkYXlzJykgPT09IDApIHx8ICFleGlzdHM7XHJcbiAgICB9XHJcblxyXG4gICAgZGF0ZUNoYW5nZWQoZGF0ZTogTW9tZW50KSB7XHJcbiAgICAgICAgdGhpcy5hcHBvaW50bWVudE1heCA9IGRhdGUuY2xvbmUoKS5hZGQoNiwgJ21vbnRocycpO1xyXG4gICAgICAgIHRoaXMubG1wTWluID0gZGF0ZS5jbG9uZSgpLnN1YnRyYWN0KDIsICd5ZWFycycpO1xyXG4gICAgICAgIHRoaXMuYXBwb2ludG1lbnRNaW4gPSBkYXRlLmNsb25lKCkuYWRkKDE0LCAnZGF5cycpO1xyXG5cclxuICAgICAgICB0aGlzLm90ekFwcGxpY2FibGUgPSAhZGF0ZS5jbG9uZSgpLnN1YnRyYWN0KDI0LCAneWVhcnMnKS5pc0FmdGVyKHRoaXMuZW50aXR5LnBhdGllbnQuZGF0ZUJpcnRoKVxyXG4gICAgICAgICAgICAmJiAhZGF0ZS5jbG9uZSgpLnN1YnRyYWN0KDEwLCAneWVhcnMnKS5pc0JlZm9yZSh0aGlzLmVudGl0eS5wYXRpZW50LmRhdGVCaXJ0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgZW50aXR5Q29tcGFyZShlMSwgZTIpIHtcclxuICAgICAgICByZXR1cm4gZW50aXR5Q29tcGFyZShlMSwgZTIpXHJcbiAgICB9XHJcblxyXG4gICAgcHJldmlvdXNTdGF0ZSgpIHtcclxuICAgICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZSgpIHtcclxuICAgICAgICB0aGlzLmlzU2F2aW5nID0gdHJ1ZTtcclxuICAgICAgICBjb25zdCB2bTogQ2xpbmljVm0gPSB7XHJcbiAgICAgICAgICAgIGNsaW5pYzogdGhpcy5lbnRpdHksXHJcbiAgICAgICAgICAgIGFkckxpc3Q6IHRoaXMuc2VsZWN0ZWRDbGluaWNBZHIuZmlsdGVyKGNhZHIgPT4gISFjYWRyLnNldmVyaXR5KSxcclxuICAgICAgICAgICAgb2lMaXN0OiB0aGlzLm9pTGlzdCxcclxuICAgICAgICAgICAgYWRoZXJlTGlzdDogdGhpcy5hZGhlcmVMaXN0XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoIXRoaXMuZW50aXR5LmV4dHJhKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLm90eiA9IHt9O1xyXG4gICAgICAgIGlmICghdGhpcy5lbnJvbGxlZE9uT1RaKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLm90ei5kYXRlRW5yb2xsZWRPbk9UWiA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLm90ei5hdHRlbmRlZExhc3RPVFpNZWV0aW5nID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEub3R6LmRhdGVMYXN0T1RaTWVldGluZyA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLm90ei5lbnJvbGxlZE9uT1RaID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEub3R6LmNhcmVnaXZlclBob25lID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEub3R6LmNhcmVnaXZlckFkZHJlc3MgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmVudGl0eS5leHRyYS5vdHoubW9kdWxlc0NvbXBsZXRlZCA9IG51bGw7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEub3R6LmRhdGVFbnJvbGxlZE9uT1RaID0gdGhpcy5kYXRlRW5yb2xsZWRPbk9UWiAhPSBudWxsICYmIHRoaXMuZGF0ZUVucm9sbGVkT25PVFouaXNWYWxpZCgpID9cclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0ZUVucm9sbGVkT25PVFouZm9ybWF0KERBVEVfRk9STUFUKSA6IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLm90ei5hdHRlbmRlZExhc3RPVFpNZWV0aW5nID0gISF0aGlzLmF0dGVuZGVkTGFzdE9UWk1lZXRpbmc7XHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLm90ei5kYXRlTGFzdE9UWk1lZXRpbmcgPSB0aGlzLmRhdGVMYXN0T1RaTWVldGluZyAhPSBudWxsICYmIHRoaXMuZGF0ZUxhc3RPVFpNZWV0aW5nLmlzVmFsaWQoKSA/XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGVMYXN0T1RaTWVldGluZy5mb3JtYXQoREFURV9GT1JNQVQpIDogbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEub3R6LmVucm9sbGVkT25PVFogPSB0aGlzLmVucm9sbGVkT25PVFo7XHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLm90ei5jYXJlZ2l2ZXJQaG9uZSA9IHRoaXMuY2FyZWdpdmVyUGhvbmU7XHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLm90ei5jYXJlZ2l2ZXJBZGRyZXNzID0gdGhpcy5jYXJlZ2l2ZXJBZGRyZXNzO1xyXG4gICAgICAgICAgICB0aGlzLmVudGl0eS5leHRyYS5vdHoubW9kdWxlc0NvbXBsZXRlZCA9IHRoaXMubW9kdWxlc0NvbXBsZXRlZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hcHBMb2FkZXJTZXJ2aWNlLm9wZW4oJ1NhdmluZyBjbGluaWMgdmlzaXQuLicpO1xyXG4gICAgICAgIGlmICh0aGlzLmVudGl0eS5pZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlVG9TYXZlUmVzcG9uc2UodGhpcy5jbGluaWNTZXJ2aWNlLnVwZGF0ZSh2bSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlVG9TYXZlUmVzcG9uc2UodGhpcy5jbGluaWNTZXJ2aWNlLmNyZWF0ZSh2bSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWdpbWVuTGluZUNoYW5nZSh0eXBlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmNsaW5pY1NlcnZpY2UuZ2V0UmVnaW1lbkJ5TGluZSh0eXBlLmlkKS5zdWJzY3JpYmUocmVzID0+IHRoaXMucmVnaW1lbnMgPSByZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3Vic2NyaWJlVG9TYXZlUmVzcG9uc2UocmVzdWx0OiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxhbnk+Pikge1xyXG4gICAgICAgIHJlc3VsdC5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgIChyZXM6IEh0dHBSZXNwb25zZTxhbnk+KSA9PiB0aGlzLm9uU2F2ZVN1Y2Nlc3MocmVzLmJvZHkpLFxyXG4gICAgICAgICAgICAocmVzOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vblNhdmVFcnJvcigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKHJlcy5tZXNzYWdlKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG9uU2F2ZVN1Y2Nlc3MocmVzdWx0OiBhbnkpIHtcclxuICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2UuY2xvc2UoKTtcclxuICAgICAgICB0aGlzLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5ub3RpZmljYXRpb24uc2hvd0luZm8oJ0NsaW5pYyB2aXNpdCBzdWNjZXNzZnVsbHkgc2F2ZWQnKTtcclxuICAgICAgICB0aGlzLnByZXZpb3VzU3RhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG9uU2F2ZUVycm9yKCkge1xyXG4gICAgICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2UuY2xvc2UoKTtcclxuICAgICAgICB0aGlzLmVycm9yID0gdHJ1ZTtcclxuICAgICAgICAvL3RoaXMuc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbi5zaG93RXJyb3IoJ0Vycm9yIG9jY3VycmVkIHNhdmluZyBjbGluaWMgdmlzaXQ7IHRyeSBhZ2FpbicpO1xyXG4gICAgICAgIC8vdGhpcy5wcm9ncmVzc0Jhci5tb2RlID0gJ2RldGVybWluYXRlJztcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgb25FcnJvcihlcnJvck1lc3NhZ2U6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuYXBwTG9hZGVyU2VydmljZS5jbG9zZSgpO1xyXG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9uLnNob3dFcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==