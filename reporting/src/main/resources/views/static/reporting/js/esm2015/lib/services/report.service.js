import * as tslib_1 from "tslib";
import { Inject, Injectable } from "@angular/core";
import { HttpClient, HttpParams } from "@angular/common/http";
import { DATE_FORMAT, SERVER_API_URL_CONFIG } from "@lamis/web-core";
import * as moment_ from 'moment';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@lamis/web-core";
const moment = moment_;
let ReportService = class ReportService {
    constructor(http, serverUrl) {
        this.http = http;
        this.serverUrl = serverUrl;
        this.resourceUrl = '';
        this.resourceUrl = serverUrl.SERVER_API_URL + '/api/reporting';
    }
    artSummary(reportingPeriod, id, today) {
        let params = new HttpParams();
        params = params.append('reportingPeriod', moment(reportingPeriod).format(DATE_FORMAT));
        params = params.append("id", id.toString());
        params = params.append("today", today.toString());
        return this.http.get(`${this.resourceUrl}/art-summary`, { params, responseType: 'blob' });
    }
    patientLineList(params) {
        params.dateCurrentStatusBegin = params.dateCurrentStatusBegin != null && params.dateCurrentStatusBegin.isValid() ? params.dateCurrentStatusBegin.format(DATE_FORMAT) : null;
        params.dateCurrentStatusEnd = params.dateCurrentStatusEnd != null && params.dateCurrentStatusEnd.isValid() ? params.dateCurrentStatusEnd.format(DATE_FORMAT) : null;
        params.dateLastViralLoadBegin = params.dateLastViralLoadBegin != null && params.dateLastViralLoadBegin.isValid() ? params.dateLastViralLoadBegin.format(DATE_FORMAT) : null;
        params.dateLastViralLoadEnd = params.dateLastViralLoadEnd != null && params.dateLastViralLoadEnd.isValid() ? params.dateLastViralLoadEnd.format(DATE_FORMAT) : null;
        params.dateRegistrationBegin = params.dateRegistrationBegin != null && params.dateRegistrationBegin.isValid() ? params.dateRegistrationBegin.format(DATE_FORMAT) : null;
        params.dateRegistrationEnd = params.dateRegistrationEnd != null && params.dateRegistrationEnd.isValid() ? params.dateRegistrationEnd.format(DATE_FORMAT) : null;
        params.dateStartedBegin = params.dateStartedBegin != null && params.dateStartedBegin.isValid() ? params.dateStartedBegin.format(DATE_FORMAT) : null;
        params.dateStartedEnd = params.dateStartedEnd != null && params.dateStartedEnd.isValid() ? params.dateStartedEnd.format(DATE_FORMAT) : null;
        return this.http.post(`${this.resourceUrl}/patient-line-list`, params, { responseType: 'blob' });
    }
    convertData(ids, report, labTest) {
        let params = new HttpParams();
        ids.forEach(id => params = params.append("ids", id.toString()));
        if (!!labTest) {
            params = params.append("labTest", labTest.toString());
        }
        params = params.append("report", report.toString());
        return this.http.get(`${this.resourceUrl}/convert-data`, { params, responseType: 'blob' });
    }
    getRegimenTypes() {
        return this.http.get(`${this.resourceUrl}/regimen-types`);
    }
    getStates() {
        return this.http.get('/api/states');
    }
    getLgasByState(id) {
        return this.http.get(`/api/provinces/state/${id}`);
    }
    getActiveFacility() {
        return this.http.get('/api/facilities/active');
    }
    listFacilities() {
        return this.http.get(`${this.resourceUrl}/list-facilities`);
    }
    labTest() {
        return this.http.get(`${this.resourceUrl}/lab-tests`);
    }
    download(name) {
        return this.http.get(`${this.resourceUrl}/download/${name}`, { responseType: 'blob' });
    }
    listFiles() {
        return this.http.get(`${this.resourceUrl}/list-files`);
    }
};
ReportService.ctorParameters = () => [
    { type: HttpClient },
    { type: undefined, decorators: [{ type: Inject, args: [SERVER_API_URL_CONFIG,] }] }
];
ReportService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function ReportService_Factory() { return new ReportService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.SERVER_API_URL_CONFIG)); }, token: ReportService, providedIn: "root" });
ReportService = tslib_1.__decorate([
    Injectable({
        providedIn: 'root'
    }),
    tslib_1.__param(1, Inject(SERVER_API_URL_CONFIG)),
    tslib_1.__metadata("design:paramtypes", [HttpClient, Object])
], ReportService);
export { ReportService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3J0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9sYW1pcy1yZXBvcnRpbmctMS4yLjAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvcmVwb3J0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDOUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxxQkFBcUIsRUFBc0IsTUFBTSxpQkFBaUIsQ0FBQztBQUd6RixPQUFPLEtBQUssT0FBTyxNQUFNLFFBQVEsQ0FBQzs7OztBQUVsQyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUM7QUFLdkIsSUFBYSxhQUFhLEdBQTFCLE1BQWEsYUFBYTtJQUd0QixZQUFvQixJQUFnQixFQUF5QyxTQUE2QjtRQUF0RixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQXlDLGNBQVMsR0FBVCxTQUFTLENBQW9CO1FBRm5HLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBR3BCLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDLGNBQWMsR0FBRyxnQkFBZ0IsQ0FBQztJQUNuRSxDQUFDO0lBRUQsVUFBVSxDQUFDLGVBQXFCLEVBQUUsRUFBVSxFQUFFLEtBQWM7UUFDeEQsSUFBSSxNQUFNLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUM5QixNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7UUFDdkYsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQzVDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxL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LENBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxZQUFZLENBQUMsQ0FBQTtJQUNoRSxDQUFDO0lBRUQsUUFBUSxDQUFDLElBQVk7UUFDakIsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLGFBQWEsSUFBSSxFQUFFLEVBQUUsRUFBQyxZQUFZLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQTtJQUN4RixDQUFDO0lBRUQsU0FBUztRQUNMLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxhQUFhLENBQUMsQ0FBQTtJQUNwRSxDQUFDO0NBQ0osQ0FBQTs7WUFsRTZCLFVBQVU7NENBQUcsTUFBTSxTQUFDLHFCQUFxQjs7O0FBSDFELGFBQWE7SUFIekIsVUFBVSxDQUFDO1FBQ1IsVUFBVSxFQUFFLE1BQU07S0FDckIsQ0FBQztJQUl5QyxtQkFBQSxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQTs2Q0FBMUMsVUFBVTtHQUgzQixhQUFhLENBcUV6QjtTQXJFWSxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBQYXJhbXMgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uL2h0dHBcIjtcbmltcG9ydCB7IERBVEVfRk9STUFULCBTRVJWRVJfQVBJX1VSTF9DT05GSUcsIFNlcnZlckFwaVVybENvbmZpZyB9IGZyb20gXCJAbGFtaXMvd2ViLWNvcmVcIjtcbmltcG9ydCB7IEZhY2lsaXR5IH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvYXJ0LXN1bW1hcnkuY29tcG9uZW50XCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCAqIGFzIG1vbWVudF8gZnJvbSAnbW9tZW50JztcblxuY29uc3QgbW9tZW50ID0gbW9tZW50XztcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBSZXBvcnRTZXJ2aWNlIHtcbiAgICBwdWJsaWMgcmVzb3VyY2VVcmwgPSAnJztcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCwgQEluamVjdChTRVJWRVJfQVBJX1VSTF9DT05GSUcpIHByaXZhdGUgc2VydmVyVXJsOiBTZXJ2ZXJBcGlVcmxDb25maWcpIHtcbiAgICAgICAgdGhpcy5yZXNvdXJjZVVybCA9IHNlcnZlclVybC5TRVJWRVJfQVBJX1VSTCArICcvYXBpL3JlcG9ydGluZyc7XG4gICAgfVxuXG4gICAgYXJ0U3VtbWFyeShyZXBvcnRpbmdQZXJpb2Q6IERhdGUsIGlkOiBudW1iZXIsIHRvZGF5OiBib29sZWFuKSB7XG4gICAgICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdyZXBvcnRpbmdQZXJpb2QnLCBtb21lbnQocmVwb3J0aW5nUGVyaW9kKS5mb3JtYXQoREFURV9GT1JNQVQpKTtcbiAgICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZChcImlkXCIsIGlkLnRvU3RyaW5nKCkpO1xuICAgICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKFwidG9kYXlcIiwgdG9kYXkudG9TdHJpbmcoKSk7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGAke3RoaXMucmVzb3VyY2VVcmx9L2FydC1zdW1tYXJ5YCwge3BhcmFtcywgcmVzcG9uc2VUeXBlOiAnYmxvYid9KVxuICAgIH1cblxuICAgIHBhdGllbnRMaW5lTGlzdChwYXJhbXM6IGFueSkge1xuICAgICAgICBwYXJhbXMuZGF0ZUN1cnJlbnRTdGF0dXNCZWdpbiA9IHBhcmFtcy5kYXRlQ3VycmVudFN0YXR1c0JlZ2luICE9IG51bGwgJiYgcGFyYW1zLmRhdGVDdXJyZW50U3RhdHVzQmVnaW4uaXNWYWxpZCgpID8gcGFyYW1zLmRhdGVDdXJyZW50U3RhdHVzQmVnaW4uZm9ybWF0KERBVEVfRk9STUFUKSA6IG51bGw7XG4gICAgICAgIHBhcmFtcy5kYXRlQ3VycmVudFN0YXR1c0VuZCA9IHBhcmFtcy5kYXRlQ3VycmVudFN0YXR1c0VuZCAhPSBudWxsICYmIHBhcmFtcy5kYXRlQ3VycmVudFN0YXR1c0VuZC5pc1ZhbGlkKCkgPyBwYXJhbXMuZGF0ZUN1cnJlbnRTdGF0dXNFbmQuZm9ybWF0KERBVEVfRk9STUFUKSA6IG51bGw7XG4gICAgICAgIHBhcmFtcy5kYXRlTGFzdFZpcmFsTG9hZEJlZ2luID0gcGFyYW1zLmRhdGVMYXN0VmlyYWxMb2FkQmVnaW4gIT0gbnVsbCAmJiBwYXJhbXMuZGF0ZUxhc3RWaXJhbExvYWRCZWdpbi5pc1ZhbGlkKCkgPyBwYXJhbXMuZGF0ZUxhc3RWaXJhbExvYWRCZWdpbi5mb3JtYXQoREFURV9GT1JNQVQpIDogbnVsbDtcbiAgICAgICAgcGFyYW1zLmRhdGVMYXN0VmlyYWxMb2FkRW5kID0gcGFyYW1zLmRhdGVMYXN0VmlyYWxMb2FkRW5kICE9IG51bGwgJiYgcGFyYW1zLmRhdGVMYXN0VmlyYWxMb2FkRW5kLmlzVmFsaWQoKSA/IHBhcmFtcy5kYXRlTGFzdFZpcmFsTG9hZEVuZC5mb3JtYXQoREFURV9GT1JNQVQpIDogbnVsbDtcbiAgICAgICAgcGFyYW1zLmRhdGVSZWdpc3RyYXRpb25CZWdpbiA9IHBhcmFtcy5kYXRlUmVnaXN0cmF0aW9uQmVnaW4gIT0gbnVsbCAmJiBwYXJhbXMuZGF0ZVJlZ2lzdHJhdGlvbkJlZ2luLmlzVmFsaWQoKSA/IHBhcmFtcy5kYXRlUmVnaXN0cmF0aW9uQmVnaW4uZm9ybWF0KERBVEVfRk9STUFUKSA6IG51bGw7XG4gICAgICAgIHBhcmFtcy5kYXRlUmVnaXN0cmF0aW9uRW5kID0gcGFyYW1zLmRhdGVSZWdpc3RyYXRpb25FbmQgIT0gbnVsbCAmJiBwYXJhbXMuZGF0ZVJlZ2lzdHJhdGlvbkVuZC5pc1ZhbGlkKCkgPyBwYXJhbXMuZGF0ZVJlZ2lzdHJhdGlvbkVuZC5mb3JtYXQoREFURV9GT1JNQVQpIDogbnVsbDtcbiAgICAgICAgcGFyYW1zLmRhdGVTdGFydGVkQmVnaW4gPSBwYXJhbXMuZGF0ZVN0YXJ0ZWRCZWdpbiAhPSBudWxsICYmIHBhcmFtcy5kYXRlU3RhcnRlZEJlZ2luLmlzVmFsaWQoKSA/IHBhcmFtcy5kYXRlU3RhcnRlZEJlZ2luLmZvcm1hdChEQVRFX0ZPUk1BVCkgOiBudWxsO1xuICAgICAgICBwYXJhbXMuZGF0ZVN0YXJ0ZWRFbmQgPSBwYXJhbXMuZGF0ZVN0YXJ0ZWRFbmQgIT0gbnVsbCAmJiBwYXJhbXMuZGF0ZVN0YXJ0ZWRFbmQuaXNWYWxpZCgpID8gcGFyYW1zLmRhdGVTdGFydGVkRW5kLmZvcm1hdChEQVRFX0ZPUk1BVCkgOiBudWxsO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QoYCR7dGhpcy5yZXNvdXJjZVVybH0vcGF0aWVudC1saW5lLWxpc3RgLCBwYXJhbXMsIHtyZXNwb25zZVR5cGU6ICdibG9iJ30pXG4gICAgfVxuXG4gICAgY29udmVydERhdGEoaWRzOiBudW1iZXJbXSwgcmVwb3J0OiBudW1iZXIsIGxhYlRlc3Q/OiBudW1iZXIpIHtcbiAgICAgICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgICAgIGlkcy5mb3JFYWNoKGlkID0+IHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoXCJpZHNcIiwgaWQudG9TdHJpbmcoKSkpO1xuICAgICAgICBpZiAoISFsYWJUZXN0KSB7XG4gICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKFwibGFiVGVzdFwiLCBsYWJUZXN0LnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoXCJyZXBvcnRcIiwgcmVwb3J0LnRvU3RyaW5nKCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldChgJHt0aGlzLnJlc291cmNlVXJsfS9jb252ZXJ0LWRhdGFgLCB7cGFyYW1zLCByZXNwb25zZVR5cGU6ICdibG9iJ30pXG4gICAgfVxuXG4gICAgZ2V0UmVnaW1lblR5cGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxhbnlbXT4oYCR7dGhpcy5yZXNvdXJjZVVybH0vcmVnaW1lbi10eXBlc2ApXG4gICAgfVxuXG5cbiAgICBnZXRTdGF0ZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PGFueVtdPignL2FwaS9zdGF0ZXMnKVxuICAgIH1cblxuICAgIGdldExnYXNCeVN0YXRlKGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PGFueVtdPihgL2FwaS9wcm92aW5jZXMvc3RhdGUvJHtpZH1gKVxuICAgIH1cblxuICAgIGdldEFjdGl2ZUZhY2lsaXR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxGYWNpbGl0eT4oJy9hcGkvZmFjaWxpdGllcy9hY3RpdmUnKVxuICAgIH1cblxuICAgIGxpc3RGYWNpbGl0aWVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxGYWNpbGl0eVtdPihgJHt0aGlzLnJlc291cmNlVXJsfS9saXN0LWZhY2lsaXRpZXNgKVxuICAgIH1cblxuICAgIGxhYlRlc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PGFueVtdPihgJHt0aGlzLnJlc291cmNlVXJsfS9sYWItdGVzdHNgKVxuICAgIH1cblxuICAgIGRvd25sb2FkKG5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8QmxvYj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldChgJHt0aGlzLnJlc291cmNlVXJsfS9kb3dubG9hZC8ke25hbWV9YCwge3Jlc3BvbnNlVHlwZTogJ2Jsb2InfSlcbiAgICB9XG5cbiAgICBsaXN0RmlsZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PHN0cmluZ1tdPihgJHt0aGlzLnJlc291cmNlVXJsfS9saXN0LWZpbGVzYClcbiAgICB9XG59XG4iXX0=