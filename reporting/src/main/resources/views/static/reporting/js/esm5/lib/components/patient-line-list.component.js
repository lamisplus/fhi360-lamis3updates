import * as tslib_1 from "tslib";
import { Component } from '@angular/core';
import { saveAs } from 'file-saver';
import { ReportService } from '../services/report.service';
import { RxStompService } from '@stomp/ng2-stompjs';
import * as moment_ from 'moment';
var moment = moment_;
var PatientLineListComponent = /** @class */ (function () {
    function PatientLineListComponent(service, stompService) {
        this.service = service;
        this.stompService = stompService;
        this.params = {};
        this.running = false;
        this.finished = false;
        this.today = moment();
        this.message = 'Running';
    }
    PatientLineListComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.service.getActiveFacility().subscribe(function (res) {
            _this.facility = res;
            _this.params['facilityId'] = _this.facility.id;
        });
        this.topicSubscription = this.stompService.watch('/topic/patient-line-list/status').subscribe(function (msg) {
            if (msg.body === 'start') {
                _this.running = true;
                _this.finished = false;
                _this.message = 'Running';
            }
            else if (msg.body === 'end') {
                _this.running = false;
                _this.finished = true;
                _this.message = 'Finished';
            }
            else {
                _this.message = msg.body;
                _this.running = true;
                _this.finished = false;
            }
        });
        this.service.getStates().subscribe(function (res) { return _this.states = res; });
        this.service.getRegimenTypes().subscribe(function (res) { return _this.regimenTypes = res; });
    };
    PatientLineListComponent.prototype.stateChanged = function (state) {
        var _this = this;
        if (state && state.id) {
            this.service.getLgasByState(state.id).subscribe(function (res) { return _this.lgas = res; });
        }
    };
    PatientLineListComponent.prototype.convert = function () {
        var _this = this;
        this.running = true;
        this.finished = false;
        this.service.patientLineList(this.params).subscribe(function (res) {
            _this.running = false;
            _this.finished = true;
            var format = _this.params.format === 'xlsx' ? 'xlsx' : 'pdf';
            var file = new File([res], _this.facility.name + "_Patient_Line_List." + format, { type: 'application/octet-stream' });
            saveAs(file);
        });
    };
    PatientLineListComponent.prototype.ngOnDestroy = function () {
        this.topicSubscription.unsubscribe();
    };
    PatientLineListComponent.ctorParameters = function () { return [
        { type: ReportService },
        { type: RxStompService }
    ]; };
    PatientLineListComponent = tslib_1.__decorate([
        Component({
            selector: 'report-patient-line-list',
            template: "<div class=\"lamis-edit-form\">\n    <div class=\"lamis-edit-form-container\">\n        <form name=\"form\" role=\"form\" novalidate (ngSubmit)=\"convert()\" #plForm=\"ngForm\">\n            <mat-card class=\"default\">\n                <mat-card-header>\n                    Patient Information Query\n                </mat-card-header>\n                <mat-card-content>\n                    <ng-container *ngIf=\"running\">\n                        <div class=\"full-width\">\n                            <mat-progress-bar class=\"full-width\" mode=\"indeterminate\"></mat-progress-bar>\n                            <mat-form-field class=\"full-width\">\n                                <input [disabled]=\"true\" matInput [value]=\"message\"/>\n                            </mat-form-field>\n                        </div>\n                    </ng-container>\n                    <ng-container *ngIf=\"finished\">\n                        <div class=\"full-width\">\n                            <mat-form-field class=\"full-width\">\n                                <input [disabled]=\"true\" matInput [value]=\"message\"/>\n                            </mat-form-field>\n                        </div>\n                    </ng-container>\n                    <fieldset>\n                        <h5>Demographic filters</h5>\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>Gender</mat-label>\n                                    <mat-select name=\"gender\" [(ngModel)]=\"params.gender\">\n                                        <mat-option></mat-option>\n                                        <mat-option value=\"MALE\">Male</mat-option>\n                                        <mat-option value=\"FEMALE\">Female</mat-option>\n                                    </mat-select>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-md-12\">\n                                <h5>Age Range</h5>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>From</mat-label>\n                                    <input matInput name=\"ageBegin\" type=\"number\" [(ngModel)]=\"params.ageBegin\"/>\n                                </mat-form-field>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>To</mat-label>\n                                    <input matInput name=\"ageEnd\" type=\"number\" [(ngModel)]=\"params.ageEnd\"/>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>State</mat-label>\n                                    <mat-select (valueChange)=\"stateChanged($event)\">\n                                        <mat-option></mat-option>\n                                        <mat-option *ngFor=\"let state of states\"\n                                                    [value]=\"state\">{{state.name}}</mat-option>\n                                    </mat-select>\n                                </mat-form-field>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>LGA of residence</mat-label>\n                                    <mat-select name=\"lga\" [(ngModel)]=\"params.lgaId\">\n                                        <mat-option></mat-option>\n                                        <mat-option *ngFor=\"let lga of lgas\" [value]=\"lga.id\">{{lga.name}}</mat-option>\n                                    </mat-select>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                    </fieldset>\n                    <fieldset>\n                        <h5>Clinical filters</h5>\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>Current Status</mat-label>\n                                    <mat-select name=\"currentStatus\" [(ngModel)]=\"params.currentStatus\">\n                                        <mat-option></mat-option>\n                                        <mat-option value=\"HIV_PLUS_NON_ART\">HIV+ non ART</mat-option>\n                                        <mat-option value=\"ART_START\">ART Start</mat-option>\n                                        <mat-option value=\"ART_RESTART\">ART Restart</mat-option>\n                                        <mat-option value=\"ART_TRANSFER_IN\">ART Transfer In</mat-option>\n                                        <mat-option value=\"ART_TRANSFER_OUT\">ART Transfer Out</mat-option>\n                                        <mat-option value=\"PRE_ART_TRANSFER_IN\">Pre-ART Transfer In</mat-option>\n                                        <mat-option value=\"PRE_ART_TRANSFER_OUT\">Pre-ART Transfer Out</mat-option>\n                                        <mat-option value=\"LOST_TO_FOLLOWUP\">Lost to Follow Up</mat-option>\n                                        <mat-option value=\"STOPPED_TREATMENT\">Stopped Treatment</mat-option>\n                                        <mat-option value=\"KNOWN_DEATH\">Known Death</mat-option>\n                                        <mat-option value=\"Currently Active\">Currently Active</mat-option>\n                                    </mat-select>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-md-12\">\n                                <h5>Date of Current Status</h5>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>From</mat-label>\n                                    <input matInput [matDatepicker]=\"picker1\"\n                                           [max]=\"today\"\n                                           [(ngModel)]=\"params.dateCurrentStatusBegin\"\n                                           name=\"date1\">\n                                    <mat-datepicker-toggle\n                                            matSuffix\n                                            [for]=\"picker1\">\n                                    </mat-datepicker-toggle>\n                                    <mat-datepicker #picker1></mat-datepicker>\n                                </mat-form-field>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>To</mat-label>\n                                    <input matInput [matDatepicker]=\"picker2\"\n                                           [(ngModel)]=\"params.dateCurrentStatusEnd\"\n                                           [max]=\"today\"\n                                           name=\"date2\">\n                                    <mat-datepicker-toggle\n                                            matSuffix\n                                            [for]=\"picker2\">\n                                    </mat-datepicker-toggle>\n                                    <mat-datepicker #picker2></mat-datepicker>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>Regimen Line</mat-label>\n                                    <mat-select name=\"regimenType\" [(ngModel)]=\"params.regimenType\">\n                                        <mat-option></mat-option>\n                                        <mat-option *ngFor=\"let type of regimenTypes\"\n                                                    [value]=\"type.description\">{{type.description}}</mat-option>\n                                    </mat-select>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-md-12\">\n                                <h5>Date of Registration</h5>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>From</mat-label>\n                                    <input matInput [matDatepicker]=\"picker3\"\n                                           [max]=\"today\"\n                                           [(ngModel)]=\"params.dateRegistrationBegin\"\n                                           name=\"date3\">\n                                    <mat-datepicker-toggle\n                                            matSuffix\n                                            [for]=\"picker3\">\n                                    </mat-datepicker-toggle>\n                                    <mat-datepicker #picker3></mat-datepicker>\n                                </mat-form-field>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>To</mat-label>\n                                    <input matInput [matDatepicker]=\"picker4\"\n                                           [max]=\"today\"\n                                           [(ngModel)]=\"params.dateRegistrationEnd\"\n                                           name=\"date4\">\n                                    <mat-datepicker-toggle\n                                            matSuffix\n                                            [for]=\"picker4\">\n                                    </mat-datepicker-toggle>\n                                    <mat-datepicker #picker4></mat-datepicker>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-md-12\">\n                                <h5>ART Start Date</h5>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>From</mat-label>\n                                    <input matInput [matDatepicker]=\"picker5\"\n                                           [max]=\"today\"\n                                           [(ngModel)]=\"params.dateStartedBegin\"\n                                           name=\"date5\">\n                                    <mat-datepicker-toggle\n                                            matSuffix\n                                            [for]=\"picker5\">\n                                    </mat-datepicker-toggle>\n                                    <mat-datepicker #picker5></mat-datepicker>\n                                </mat-form-field>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>To</mat-label>\n                                    <input matInput [matDatepicker]=\"picker6\"\n                                           [max]=\"today\"\n                                           [(ngModel)]=\"params.dateStartedEnd\"\n                                           name=\"date6\">\n                                    <mat-datepicker-toggle\n                                            matSuffix\n                                            [for]=\"picker6\">\n                                    </mat-datepicker-toggle>\n                                    <mat-datepicker #picker6></mat-datepicker>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-label>Current Clinical Stage</mat-label>\n                                    <mat-select name=\"clinicStage\" [(ngModel)]=\"params.clinicStage\">\n                                        <mat-option></mat-option>\n                                        <mat-option value=\"Stage I\">Stage I</mat-option>\n                                        <mat-option value=\"Stage II\">Stage II</mat-option>\n                                        <mat-option value=\"Stage III\">Stage III</mat-option>\n                                        <mat-option value=\"Stage IV\">Stage IV</mat-option>\n                                    </mat-select>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <fieldset>\n                            <h5>Viral Load</h5>\n                            <div class=\"row\">\n                                <div class=\"col-md-12\">\n                                    <h5>Last Viral Load</h5>\n                                </div>\n                                <div class=\"col-md-6\">\n                                    <mat-form-field class=\"full-width\">\n                                        <mat-label>From</mat-label>\n                                        <input matInput name=\"viralLoadBegin\" type=\"number\"\n                                               [(ngModel)]=\"params.viralLoadBegin\"/>\n                                    </mat-form-field>\n                                </div>\n                                <div class=\"col-md-6\">\n                                    <mat-form-field class=\"full-width\">\n                                        <mat-label>To</mat-label>\n                                        <input matInput name=\"viralLoadEnd\" type=\"number\"\n                                               [(ngModel)]=\"params.viralLoadEnd\"/>\n                                    </mat-form-field>\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-md-12\">\n                                    <h5>Date of Last Viral Load</h5>\n                                </div>\n                                <div class=\"col-md-6\">\n                                    <mat-form-field class=\"full-width\">\n                                        <mat-label>From</mat-label>\n                                        <input matInput [matDatepicker]=\"picker7\"\n                                               [max]=\"today\"\n                                               [(ngModel)]=\"params.dateLastViralLoadBegin\"\n                                               name=\"date7\">\n                                        <mat-datepicker-toggle\n                                                matSuffix\n                                                [for]=\"picker7\">\n                                        </mat-datepicker-toggle>\n                                        <mat-datepicker #picker7></mat-datepicker>\n                                    </mat-form-field>\n                                </div>\n                                <div class=\"col-md-6\">\n                                    <mat-form-field class=\"full-width\">\n                                        <mat-label>To</mat-label>\n                                        <input matInput [matDatepicker]=\"picker8\"\n                                               [max]=\"today\"\n                                               [(ngModel)]=\"params.dateLastViralLoadEnd\"\n                                               name=\"date8\">\n                                        <mat-datepicker-toggle\n                                                matSuffix\n                                                [for]=\"picker8\">\n                                        </mat-datepicker-toggle>\n                                        <mat-datepicker #picker8></mat-datepicker>\n                                    </mat-form-field>\n                                </div>\n                            </div>\n                        </fieldset>\n                    </fieldset>\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <label id=\"label\">Output format</label>\n                            <mat-radio-group [(ngModel)]=\"params.format\" name=\"format\" aria-labelledby=\"label\" class=\"radio-group\">\n                                <mat-radio-button [value]=\"'PDF'\" class=\"radio-button\">PDF</mat-radio-button>\n                                <mat-radio-button [value]=\"'xlsx'\" class=\"radio-button\">Excel</mat-radio-button>\n                            </mat-radio-group>\n                        </div>\n                    </div>\n                    <mat-card-actions>\n                        <button mat-raised-button color=\"primary\"\n                                [disabled]=\"running || !facility\">Generate Report\n                        </button>\n                    </mat-card-actions>\n                </mat-card-content>\n            </mat-card>\n        </form>\n    </div>\n</div>\n",
            styles: [".radio-group{display:flex;flex-direction:column;margin:15px 0}.radio-button{margin:5px}"]
        }),
        tslib_1.__metadata("design:paramtypes", [ReportService, RxStompService])
    ], PatientLineListComponent);
    return PatientLineListComponent;
}());
export { PatientLineListComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0aWVudC1saW5lLWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbGFtaXMtcmVwb3J0aW5nLTEuMi4wLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcGF0aWVudC1saW5lLWxpc3QuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFxQixNQUFNLGVBQWUsQ0FBQztBQUc3RCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3BDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFcEQsT0FBTyxLQUFLLE9BQU8sTUFBTSxRQUFRLENBQUM7QUFFbEMsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDO0FBT3ZCO0lBWUksa0NBQW9CLE9BQXNCLEVBQVUsWUFBNEI7UUFBNUQsWUFBTyxHQUFQLE9BQU8sQ0FBZTtRQUFVLGlCQUFZLEdBQVosWUFBWSxDQUFnQjtRQVhoRixXQUFNLEdBQTJCLEVBQUUsQ0FBQztRQU1wQyxZQUFPLEdBQUcsS0FBSyxDQUFDO1FBQ2hCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsVUFBSyxHQUFHLE1BQU0sRUFBRSxDQUFDO1FBQ2pCLFlBQU8sR0FBUSxTQUFTLENBQUM7SUFHekIsQ0FBQztJQUVELDJDQUFRLEdBQVI7UUFBQSxpQkFzQkM7UUFyQkcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLFNBQVMsQ0FBQyxVQUFBLEdBQUc7WUFDMUMsS0FBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUM7WUFDcEIsS0FBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxLQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztRQUNqRCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJ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O1NBNURZLHdCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25EZXN0cm95LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRmFjaWxpdHkgfSBmcm9tICcuL2FydC1zdW1tYXJ5LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBzYXZlQXMgfSBmcm9tICdmaWxlLXNhdmVyJztcbmltcG9ydCB7IFJlcG9ydFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9yZXBvcnQuc2VydmljZSc7XG5pbXBvcnQgeyBSeFN0b21wU2VydmljZSB9IGZyb20gJ0BzdG9tcC9uZzItc3RvbXBqcyc7XG5pbXBvcnQgeyBNZXNzYWdlIH0gZnJvbSAnQHN0b21wL3N0b21wanMnO1xuaW1wb3J0ICogYXMgbW9tZW50XyBmcm9tICdtb21lbnQnO1xuXG5jb25zdCBtb21lbnQgPSBtb21lbnRfO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3JlcG9ydC1wYXRpZW50LWxpbmUtbGlzdCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3BhdGllbnQtbGluZS1saXN0LmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9wYXRpZW50LWxpbmUtbGlzdC5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIFBhdGllbnRMaW5lTGlzdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgICBwYXJhbXM6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcbiAgICBzdGF0ZXM6IGFueVtdO1xuICAgIHJlZ2ltZW5UeXBlczogYW55W107XG4gICAgbGdhczogYW55W107XG4gICAgcHJpdmF0ZSB0b3BpY1N1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICAgIGZhY2lsaXR5OiBGYWNpbGl0eTtcbiAgICBydW5uaW5nID0gZmFsc2U7XG4gICAgZmluaXNoZWQgPSBmYWxzZTtcbiAgICB0b2RheSA9IG1vbWVudCgpO1xuICAgIG1lc3NhZ2U6IGFueSA9ICdSdW5uaW5nJztcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc2VydmljZTogUmVwb3J0U2VydmljZSwgcHJpdmF0ZSBzdG9tcFNlcnZpY2U6IFJ4U3RvbXBTZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuc2VydmljZS5nZXRBY3RpdmVGYWNpbGl0eSgpLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICAgICAgdGhpcy5mYWNpbGl0eSA9IHJlcztcbiAgICAgICAgICAgIHRoaXMucGFyYW1zWydmYWNpbGl0eUlkJ10gPSB0aGlzLmZhY2lsaXR5LmlkO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50b3BpY1N1YnNjcmlwdGlvbiA9IHRoaXMuc3RvbXBTZXJ2aWNlLndhdGNoKCcvdG9waWMvcGF0aWVudC1saW5lLWxpc3Qvc3RhdHVzJykuc3Vic2NyaWJlKChtc2c6IE1lc3NhZ2UpID0+IHtcbiAgICAgICAgICAgIGlmIChtc2cuYm9keSA9PT0gJ3N0YXJ0Jykge1xuICAgICAgICAgICAgICAgIHRoaXMucnVubmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZSA9ICdSdW5uaW5nJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobXNnLmJvZHkgPT09ICdlbmQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gJ0ZpbmlzaGVkJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gbXNnLmJvZHk7XG4gICAgICAgICAgICAgICAgdGhpcy5ydW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmlzaGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0U3RhdGVzKCkuc3Vic2NyaWJlKHJlcyA9PiB0aGlzLnN0YXRlcyA9IHJlcyk7XG4gICAgICAgIHRoaXMuc2VydmljZS5nZXRSZWdpbWVuVHlwZXMoKS5zdWJzY3JpYmUocmVzID0+IHRoaXMucmVnaW1lblR5cGVzID0gcmVzKTtcbiAgICB9XG5cbiAgICBzdGF0ZUNoYW5nZWQoc3RhdGUpIHtcbiAgICAgICAgaWYgKHN0YXRlICYmIHN0YXRlLmlkKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0TGdhc0J5U3RhdGUoc3RhdGUuaWQpLnN1YnNjcmliZShyZXMgPT4gdGhpcy5sZ2FzID0gcmVzKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29udmVydCgpIHtcbiAgICAgICAgdGhpcy5ydW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5maW5pc2hlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlcnZpY2UucGF0aWVudExpbmVMaXN0KHRoaXMucGFyYW1zKS5zdWJzY3JpYmUoKHJlcykgPT4ge1xuICAgICAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmZpbmlzaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGxldCBmb3JtYXQgPSB0aGlzLnBhcmFtcy5mb3JtYXQgPT09ICd4bHN4JyA/ICd4bHN4JyA6ICdwZGYnO1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IG5ldyBGaWxlKFtyZXNdLCBgJHt0aGlzLmZhY2lsaXR5Lm5hbWV9X1BhdGllbnRfTGluZV9MaXN0LiR7Zm9ybWF0fWAsIHt0eXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJ30pO1xuICAgICAgICAgICAgc2F2ZUFzKGZpbGUpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnRvcGljU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKClcbiAgICB9XG59XG4iXX0=