import * as tslib_1 from "tslib";
import { Inject, Injectable } from "@angular/core";
import { HttpClient, HttpParams } from "@angular/common/http";
import { DATE_FORMAT, SERVER_API_URL_CONFIG } from "@lamis/web-core";
import * as moment_ from 'moment';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@lamis/web-core";
var moment = moment_;
var ReportService = /** @class */ (function () {
    function ReportService(http, serverUrl) {
        this.http = http;
        this.serverUrl = serverUrl;
        this.resourceUrl = '';
        this.resourceUrl = serverUrl.SERVER_API_URL + '/api/reporting';
    }
    ReportService.prototype.artSummary = function (reportingPeriod, id, today) {
        var params = new HttpParams();
        params = params.append('reportingPeriod', moment(reportingPeriod).format(DATE_FORMAT));
        params = params.append("id", id.toString());
        params = params.append("today", today.toString());
        return this.http.get(this.resourceUrl + "/art-summary", { params: params, responseType: 'blob' });
    };
    ReportService.prototype.patientLineList = function (params) {
        params.dateCurrentStatusBegin = params.dateCurrentStatusBegin != null && params.dateCurrentStatusBegin.isValid() ? params.dateCurrentStatusBegin.format(DATE_FORMAT) : null;
        params.dateCurrentStatusEnd = params.dateCurrentStatusEnd != null && params.dateCurrentStatusEnd.isValid() ? params.dateCurrentStatusEnd.format(DATE_FORMAT) : null;
        params.dateLastViralLoadBegin = params.dateLastViralLoadBegin != null && params.dateLastViralLoadBegin.isValid() ? params.dateLastViralLoadBegin.format(DATE_FORMAT) : null;
        params.dateLastViralLoadEnd = params.dateLastViralLoadEnd != null && params.dateLastViralLoadEnd.isValid() ? params.dateLastViralLoadEnd.format(DATE_FORMAT) : null;
        params.dateRegistrationBegin = params.dateRegistrationBegin != null && params.dateRegistrationBegin.isValid() ? params.dateRegistrationBegin.format(DATE_FORMAT) : null;
        params.dateRegistrationEnd = params.dateRegistrationEnd != null && params.dateRegistrationEnd.isValid() ? params.dateRegistrationEnd.format(DATE_FORMAT) : null;
        params.dateStartedBegin = params.dateStartedBegin != null && params.dateStartedBegin.isValid() ? params.dateStartedBegin.format(DATE_FORMAT) : null;
        params.dateStartedEnd = params.dateStartedEnd != null && params.dateStartedEnd.isValid() ? params.dateStartedEnd.format(DATE_FORMAT) : null;
        return this.http.post(this.resourceUrl + "/patient-line-list", params, { responseType: 'blob' });
    };
    ReportService.prototype.convertData = function (ids, report, labTest) {
        var params = new HttpParams();
        ids.forEach(function (id) { return params = params.append("ids", id.toString()); });
        if (!!labTest) {
            params = params.append("labTest", labTest.toString());
        }
        params = params.append("report", report.toString());
        return this.http.get(this.resourceUrl + "/convert-data", { params: params, responseType: 'blob' });
    };
    ReportService.prototype.getRegimenTypes = function () {
        return this.http.get(this.resourceUrl + "/regimen-types");
    };
    ReportService.prototype.getStates = function () {
        return this.http.get('/api/states');
    };
    ReportService.prototype.getLgasByState = function (id) {
        return this.http.get("/api/provinces/state/" + id);
    };
    ReportService.prototype.getActiveFacility = function () {
        return this.http.get('/api/facilities/active');
    };
    ReportService.prototype.listFacilities = function () {
        return this.http.get(this.resourceUrl + "/list-facilities");
    };
    ReportService.prototype.labTest = function () {
        return this.http.get(this.resourceUrl + "/lab-tests");
    };
    ReportService.prototype.download = function (name) {
        return this.http.get(this.resourceUrl + "/download/" + name, { responseType: 'blob' });
    };
    ReportService.prototype.listFiles = function () {
        return this.http.get(this.resourceUrl + "/list-files");
    };
    ReportService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: undefined, decorators: [{ type: Inject, args: [SERVER_API_URL_CONFIG,] }] }
    ]; };
    ReportService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function ReportService_Factory() { return new ReportService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.SERVER_API_URL_CONFIG)); }, token: ReportService, providedIn: "root" });
    ReportService = tslib_1.__decorate([
        Injectable({
            providedIn: 'root'
        }),
        tslib_1.__param(1, Inject(SERVER_API_URL_CONFIG)),
        tslib_1.__metadata("design:paramtypes", [HttpClient, Object])
    ], ReportService);
    return ReportService;
}());
export { ReportService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3J0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9sYW1pcy1yZXBvcnRpbmctMS4yLjAvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvcmVwb3J0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDOUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxxQkFBcUIsRUFBc0IsTUFBTSxpQkFBaUIsQ0FBQztBQUd6RixPQUFPLEtBQUssT0FBTyxNQUFNLFFBQVEsQ0FBQzs7OztBQUVsQyxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUM7QUFLdkI7SUFHSSx1QkFBb0IsSUFBZ0IsRUFBeUMsU0FBNkI7UUFBdEYsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUF5QyxjQUFTLEdBQVQsU0FBUyxDQUFvQjtRQUZuRyxnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUdwQixJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQyxjQUFjLEdBQUcsZ0JBQWdCLENBQUM7SUFDbkUsQ0FBQztJQUVELGtDQUFVLEdBQVYsVUFBVyxlQUFxQixFQUFFLEVBQVUsRUFBRSxLQUFjO1FBQ3hELElBQUksTUFBTSxHQUFHLElBQUksVUFBVSxFQUFFLENBQUM7UUFDOUIsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQ3ZGLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUM1QyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDbEQsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBSSxJQUFJLENBQUMsV0FBVyxpQkFBYyxFQUFFLEVBQUMsTUFBTSxRQUFBLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUE7SUFDM0YsQ0FBQztJQUVELHVDQUFlLEdBQWYsVUFBZ0IsTUFBVztRQUN2QixNQUFNLENBQUMsc0JBQXNCLEdBQUcsTUFBTSxDQUFDLHNCQUFzQixJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsc0JBQXNCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUM1SyxNQUFNLENBQUMsb0JBQW9CLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsb0JBQW9CLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNwSyxNQUFNLENBQUMsc0JBQXNCLEdBQUcsTUFBTSxDQUFDLHNCQUFzQixJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsc0JBQXNCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUM1SyxNQUFNLENBQUMsb0JBQW9CLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsb0JBQW9CLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNwSyxNQUFNLENBQUMscUJBQXFCLEdBQUcsTUFBTSxDQUFDLHFCQUFxQixJQUFJLElBQUksSUFBSSxNQUFNLENBQUMscUJBQXFCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUN4SyxNQUFNLENBQUMsbUJBQW1CLEdBQUcsTUFBTSxDQUFDLG1CQUFtQixJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNoSyxNQUFNLENBQUMsZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNwSixNQUFNLENBQUMsY0FBYyxHQUFHLE1BQU0sQ0FBQyxjQUFjLElBQUksSUFBSSxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDNUksT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBSSxJQUFJLENBQUMsV0FBVyx1QkFBb0IsRUFBRSxNQUFNLEVBQUUsRUFBQyxZQUFZLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQTtJQUNsRyxDQUFDO0lBRUQsbUNBQVcsR0FBWCxVQUFZLEdBQWEsRUFBRSxNQUFjLEVBQUUsT0FBZ0I7UUFDdkQsSUFBSSxNQUFNLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUM5QixHQUFHLENBQUMsT0FBTyxDQUFDLFVBQUEsRUFBRSxJQUFJLE9BQUEsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUE1QyxDQUE0QyxDQUFDLENBQUM7UUFDaEUsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFO1lBQ1gsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1NBQ3pEO1FBQ0QsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQ3BELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUksSUFBSSxDQUFDLFdBQVcsa0JBQWUsRUFBRSxFQUFDLE1BQU0sUUFBQSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFBO0lBQzVGLENBQUM7SUFFRCx1Q0FBZSxHQUFmO1FBQ0ksT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBVyxJQUFJLENBQUMsV0FBVyxtQkFBZ0IsQ0FBQyxDQUFBO0lBQ3BFLENBQUM7SUFHRCxpQ0FBUyxHQUFUO1FBQ0ksT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBUSxhQUFhLENBQUMsQ0FBQTtJQUM5QyxDQUFDO0lBRUQsc0NBQWMsR0FBZCxVQUFlLEVBQUU7UUFDYixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFRLDBCQUF3QixFQUFJLENBQUMsQ0FBQTtJQUM3RCxDQUFDO0lBRUQseUNBQWlCLEdBQWpCO1FBQ0ksT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBVyx3QkFBd0IsQ0FBQyxDQUFBO0lBQzVELENBQUM7SUFFRCxzQ0FBYyxHQUFkO1FBQ0ksT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBZ0IsSUFBSSxDQUFDLFdBQVcscUJBQWtCLENBQUMsQ0FBQTtJQUMzRSxDQUFDO0lBRUQsK0JBQU8sR0FBUDtRQUNJLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQVcsSUFBSSxDQUFDLFdBQVcsZUFBWSxDQUFDLENBQUE7SUFDaEUsQ0FBQztJQUVELGdDQUFRLEdBQVIsVUFBUyxJQUFZO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUksSUFBSSxDQUFDLFdBQVcsa0JBQWEsSUFBTSxFQUFFLEVBQUMsWUFBWSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUE7SUFDeEYsQ0FBQztJQUVELGlDQUFTLEdBQVQ7UUFDSSxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFjLElBQUksQ0FBQyxXQUFXLGdCQUFhLENBQUMsQ0FBQTtJQUNwRSxDQUFDOztnQkFqRXlCLFVBQVU7Z0RBQUcsTUFBTSxTQUFDLHFCQUFxQjs7O0lBSDFELGFBQWE7UUFIekIsVUFBVSxDQUFDO1lBQ1IsVUFBVSxFQUFFLE1BQU07U0FDckIsQ0FBQztRQUl5QyxtQkFBQSxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQTtpREFBMUMsVUFBVTtPQUgzQixhQUFhLENBcUV6Qjt3QkFqRkQ7Q0FpRkMsQUFyRUQsSUFxRUM7U0FyRVksYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwUGFyYW1zIH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vbi9odHRwXCI7XG5pbXBvcnQgeyBEQVRFX0ZPUk1BVCwgU0VSVkVSX0FQSV9VUkxfQ09ORklHLCBTZXJ2ZXJBcGlVcmxDb25maWcgfSBmcm9tIFwiQGxhbWlzL3dlYi1jb3JlXCI7XG5pbXBvcnQgeyBGYWNpbGl0eSB9IGZyb20gXCIuLi9jb21wb25lbnRzL2FydC1zdW1tYXJ5LmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzXCI7XG5pbXBvcnQgKiBhcyBtb21lbnRfIGZyb20gJ21vbWVudCc7XG5cbmNvbnN0IG1vbWVudCA9IG1vbWVudF87XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUmVwb3J0U2VydmljZSB7XG4gICAgcHVibGljIHJlc291cmNlVXJsID0gJyc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsIEBJbmplY3QoU0VSVkVSX0FQSV9VUkxfQ09ORklHKSBwcml2YXRlIHNlcnZlclVybDogU2VydmVyQXBpVXJsQ29uZmlnKSB7XG4gICAgICAgIHRoaXMucmVzb3VyY2VVcmwgPSBzZXJ2ZXJVcmwuU0VSVkVSX0FQSV9VUkwgKyAnL2FwaS9yZXBvcnRpbmcnO1xuICAgIH1cblxuICAgIGFydFN1bW1hcnkocmVwb3J0aW5nUGVyaW9kOiBEYXRlLCBpZDogbnVtYmVyLCB0b2RheTogYm9vbGVhbikge1xuICAgICAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgncmVwb3J0aW5nUGVyaW9kJywgbW9tZW50KHJlcG9ydGluZ1BlcmlvZCkuZm9ybWF0KERBVEVfRk9STUFUKSk7XG4gICAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoXCJpZFwiLCBpZC50b1N0cmluZygpKTtcbiAgICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZChcInRvZGF5XCIsIHRvZGF5LnRvU3RyaW5nKCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldChgJHt0aGlzLnJlc291cmNlVXJsfS9hcnQtc3VtbWFyeWAsIHtwYXJhbXMsIHJlc3BvbnNlVHlwZTogJ2Jsb2InfSlcbiAgICB9XG5cbiAgICBwYXRpZW50TGluZUxpc3QocGFyYW1zOiBhbnkpIHtcbiAgICAgICAgcGFyYW1zLmRhdGVDdXJyZW50U3RhdHVzQmVnaW4gPSBwYXJhbXMuZGF0ZUN1cnJlbnRTdGF0dXNCZWdpbiAhPSBudWxsICYmIHBhcmFtcy5kYXRlQ3VycmVudFN0YXR1c0JlZ2luLmlzVmFsaWQoKSA/IHBhcmFtcy5kYXRlQ3VycmVudFN0YXR1c0JlZ2luLmZvcm1hdChEQVRFX0ZPUk1BVCkgOiBudWxsO1xuICAgICAgICBwYXJhbXMuZGF0ZUN1cnJlbnRTdGF0dXNFbmQgPSBwYXJhbXMuZGF0ZUN1cnJlbnRTdGF0dXNFbmQgIT0gbnVsbCAmJiBwYXJhbXMuZGF0ZUN1cnJlbnRTdGF0dXNFbmQuaXNWYWxpZCgpID8gcGFyYW1zLmRhdGVDdXJyZW50U3RhdHVzRW5kLmZvcm1hdChEQVRFX0ZPUk1BVCkgOiBudWxsO1xuICAgICAgICBwYXJhbXMuZGF0ZUxhc3RWaXJhbExvYWRCZWdpbiA9IHBhcmFtcy5kYXRlTGFzdFZpcmFsTG9hZEJlZ2luICE9IG51bGwgJiYgcGFyYW1zLmRhdGVMYXN0VmlyYWxMb2FkQmVnaW4uaXNWYWxpZCgpID8gcGFyYW1zLmRhdGVMYXN0VmlyYWxMb2FkQmVnaW4uZm9ybWF0KERBVEVfRk9STUFUKSA6IG51bGw7XG4gICAgICAgIHBhcmFtcy5kYXRlTGFzdFZpcmFsTG9hZEVuZCA9IHBhcmFtcy5kYXRlTGFzdFZpcmFsTG9hZEVuZCAhPSBudWxsICYmIHBhcmFtcy5kYXRlTGFzdFZpcmFsTG9hZEVuZC5pc1ZhbGlkKCkgPyBwYXJhbXMuZGF0ZUxhc3RWaXJhbExvYWRFbmQuZm9ybWF0KERBVEVfRk9STUFUKSA6IG51bGw7XG4gICAgICAgIHBhcmFtcy5kYXRlUmVnaXN0cmF0aW9uQmVnaW4gPSBwYXJhbXMuZGF0ZVJlZ2lzdHJhdGlvbkJlZ2luICE9IG51bGwgJiYgcGFyYW1zLmRhdGVSZWdpc3RyYXRpb25CZWdpbi5pc1ZhbGlkKCkgPyBwYXJhbXMuZGF0ZVJlZ2lzdHJhdGlvbkJlZ2luLmZvcm1hdChEQVRFX0ZPUk1BVCkgOiBudWxsO1xuICAgICAgICBwYXJhbXMuZGF0ZVJlZ2lzdHJhdGlvbkVuZCA9IHBhcmFtcy5kYXRlUmVnaXN0cmF0aW9uRW5kICE9IG51bGwgJiYgcGFyYW1zLmRhdGVSZWdpc3RyYXRpb25FbmQuaXNWYWxpZCgpID8gcGFyYW1zLmRhdGVSZWdpc3RyYXRpb25FbmQuZm9ybWF0KERBVEVfRk9STUFUKSA6IG51bGw7XG4gICAgICAgIHBhcmFtcy5kYXRlU3RhcnRlZEJlZ2luID0gcGFyYW1zLmRhdGVTdGFydGVkQmVnaW4gIT0gbnVsbCAmJiBwYXJhbXMuZGF0ZVN0YXJ0ZWRCZWdpbi5pc1ZhbGlkKCkgPyBwYXJhbXMuZGF0ZVN0YXJ0ZWRCZWdpbi5mb3JtYXQoREFURV9GT1JNQVQpIDogbnVsbDtcbiAgICAgICAgcGFyYW1zLmRhdGVTdGFydGVkRW5kID0gcGFyYW1zLmRhdGVTdGFydGVkRW5kICE9IG51bGwgJiYgcGFyYW1zLmRhdGVTdGFydGVkRW5kLmlzVmFsaWQoKSA/IHBhcmFtcy5kYXRlU3RhcnRlZEVuZC5mb3JtYXQoREFURV9GT1JNQVQpIDogbnVsbDtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KGAke3RoaXMucmVzb3VyY2VVcmx9L3BhdGllbnQtbGluZS1saXN0YCwgcGFyYW1zLCB7cmVzcG9uc2VUeXBlOiAnYmxvYid9KVxuICAgIH1cblxuICAgIGNvbnZlcnREYXRhKGlkczogbnVtYmVyW10sIHJlcG9ydDogbnVtYmVyLCBsYWJUZXN0PzogbnVtYmVyKSB7XG4gICAgICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgICAgICBpZHMuZm9yRWFjaChpZCA9PiBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKFwiaWRzXCIsIGlkLnRvU3RyaW5nKCkpKTtcbiAgICAgICAgaWYgKCEhbGFiVGVzdCkge1xuICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZChcImxhYlRlc3RcIiwgbGFiVGVzdC50b1N0cmluZygpKTtcbiAgICAgICAgfVxuICAgICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKFwicmVwb3J0XCIsIHJlcG9ydC50b1N0cmluZygpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoYCR7dGhpcy5yZXNvdXJjZVVybH0vY29udmVydC1kYXRhYCwge3BhcmFtcywgcmVzcG9uc2VUeXBlOiAnYmxvYid9KVxuICAgIH1cblxuICAgIGdldFJlZ2ltZW5UeXBlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8YW55W10+KGAke3RoaXMucmVzb3VyY2VVcmx9L3JlZ2ltZW4tdHlwZXNgKVxuICAgIH1cblxuXG4gICAgZ2V0U3RhdGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxhbnlbXT4oJy9hcGkvc3RhdGVzJylcbiAgICB9XG5cbiAgICBnZXRMZ2FzQnlTdGF0ZShpZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxhbnlbXT4oYC9hcGkvcHJvdmluY2VzL3N0YXRlLyR7aWR9YClcbiAgICB9XG5cbiAgICBnZXRBY3RpdmVGYWNpbGl0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8RmFjaWxpdHk+KCcvYXBpL2ZhY2lsaXRpZXMvYWN0aXZlJylcbiAgICB9XG5cbiAgICBsaXN0RmFjaWxpdGllcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8RmFjaWxpdHlbXT4oYCR7dGhpcy5yZXNvdXJjZVVybH0vbGlzdC1mYWNpbGl0aWVzYClcbiAgICB9XG5cbiAgICBsYWJUZXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxhbnlbXT4oYCR7dGhpcy5yZXNvdXJjZVVybH0vbGFiLXRlc3RzYClcbiAgICB9XG5cbiAgICBkb3dubG9hZChuYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEJsb2I+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoYCR7dGhpcy5yZXNvdXJjZVVybH0vZG93bmxvYWQvJHtuYW1lfWAsIHtyZXNwb25zZVR5cGU6ICdibG9iJ30pXG4gICAgfVxuXG4gICAgbGlzdEZpbGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxzdHJpbmdbXT4oYCR7dGhpcy5yZXNvdXJjZVVybH0vbGlzdC1maWxlc2ApXG4gICAgfVxufVxuIl19